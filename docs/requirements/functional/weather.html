<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-requirements/functional/weather" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Weather | Browser Dashboard PWA</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://migmolrod.github.io/browser-dashboard-pwa/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://migmolrod.github.io/browser-dashboard-pwa/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://migmolrod.github.io/browser-dashboard-pwa/docs/requirements/functional/weather"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Weather | Browser Dashboard PWA"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/browser-dashboard-pwa/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://migmolrod.github.io/browser-dashboard-pwa/docs/requirements/functional/weather"><link data-rh="true" rel="alternate" href="https://migmolrod.github.io/browser-dashboard-pwa/docs/requirements/functional/weather" hreflang="en"><link data-rh="true" rel="alternate" href="https://migmolrod.github.io/browser-dashboard-pwa/docs/requirements/functional/weather" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Weather","item":"https://migmolrod.github.io/browser-dashboard-pwa/docs/requirements/functional/weather"}]}</script><link rel="alternate" type="application/rss+xml" href="/browser-dashboard-pwa/blog/rss.xml" title="Browser Dashboard PWA RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/browser-dashboard-pwa/blog/atom.xml" title="Browser Dashboard PWA Atom Feed"><link rel="stylesheet" href="/browser-dashboard-pwa/assets/css/styles.e98d30eb.css">
<script src="/browser-dashboard-pwa/assets/js/runtime~main.68b3217f.js" defer="defer"></script>
<script src="/browser-dashboard-pwa/assets/js/main.61bba1e5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/browser-dashboard-pwa/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_ZENM" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/browser-dashboard-pwa/"><div class="navbar__logo"><img src="/browser-dashboard-pwa/img/logo.svg" alt="Browser Dashboard PWA Logo" class="themedComponent_ZSly themedComponent--light_ac4g"><img src="/browser-dashboard-pwa/img/logo.svg" alt="Browser Dashboard PWA Logo" class="themedComponent_ZSly themedComponent--dark_geaY"></div><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/browser-dashboard-pwa/docs/domain/overview">DMD</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/browser-dashboard-pwa/docs/requirements/overview">SRS</a><a class="navbar__item navbar__link" href="/browser-dashboard-pwa/docs/architecture/overview">SAD</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/browser-dashboard-pwa/blog">Blog</a><a href="https://github.com/migmolrod/browser-dashboard-pwa" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_j3rN"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_dfOL colorModeToggle_OMHc"><button class="clean-btn toggleButton_sYJK toggleButtonDisabled_uhoL" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_DOsv lightToggleIcon_cRsD"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_DOsv darkToggleIcon_dhlZ"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_DOsv systemToggleIcon_De7l"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_n3EO"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_Cmuq"><div class="docsWrapper_qr6I"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_PPUa" type="button"></button><div class="docRoot_mfoW"><aside class="theme-doc-sidebar-container docSidebarContainer_ag_q"><div class="sidebarViewport_BDDu"><div class="sidebar_ioLr"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_u_pe"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/browser-dashboard-pwa/docs/requirements/overview"><span title="Requirements overview" class="linkLabel_dWUb">Requirements overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/browser-dashboard-pwa/docs/requirements/templates"><span title="Templates" class="linkLabel_dWUb">Templates</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/browser-dashboard-pwa/docs/requirements/business-requirements"><span title="Business requirements" class="linkLabel_dWUb">Business requirements</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_wRzA menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/browser-dashboard-pwa/docs/requirements/functional/dashboard-management"><span title="Functional requirements" class="categoryLinkLabel_gvR2">Functional requirements</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/dashboard-management"><span title="Dashboard Management" class="linkLabel_dWUb">Dashboard Management</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/bookmarks"><span title="Bookmarks" class="linkLabel_dWUb">Bookmarks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/tasks"><span title="Tasks" class="linkLabel_dWUb">Tasks</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/calendar"><span title="Calendar" class="linkLabel_dWUb">Calendar</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/weather"><span title="Weather" class="linkLabel_dWUb">Weather</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/user-identity"><span title="User identity" class="linkLabel_dWUb">User identity</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/preferences"><span title="Preferences" class="linkLabel_dWUb">Preferences</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/browser-dashboard-pwa/docs/requirements/functional/synchronization"><span title="Synchronization" class="linkLabel_dWUb">Synchronization</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/browser-dashboard-pwa/docs/requirements/non-functional-requirements"><span title="Non-Functional requirements" class="linkLabel_dWUb">Non-Functional requirements</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/browser-dashboard-pwa/docs/requirements/user-stories"><span title="User Stories" class="linkLabel_dWUb">User Stories</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/browser-dashboard-pwa/docs/requirements/system-requirements"><span title="System requirements" class="linkLabel_dWUb">System requirements</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_j2Zb"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_spGC"><div class="docItemContainer_nKy5"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_rpXH" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/browser-dashboard-pwa/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_Y6Bx"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Functional requirements</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Weather</span></li></ul></nav><div class="tocCollapsible_jwPn theme-doc-toc-mobile tocMobile_A1u9"><button type="button" class="clean-btn tocCollapsibleButton_Dmq1">On this page</button></div><div class="theme-doc-markdown markdown"><div class="reqMetadata_OnDx"><div><strong>Status: </strong><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></div><span><strong>Last updated</strong>: <!-- -->November 17, 2025</span></div>
<header><h1>Weather</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_eVCZ" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>The Weather bounded context fetches and presents current weather data for configured locations. It retrieves data from
third-party weather providers, caches responses to optimize API usage, and supplies weather information to dashboard
widgets. The context is read-model oriented with minimal write operations.</p>
<p><strong>Bounded context code:</strong> WEA<br>
<strong>Related DMD section:</strong> <a class="" href="/browser-dashboard-pwa/docs/domain/bounded-contexts/weather">Weather (Supporting)</a></p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_eVCZ" id="features">Features<a href="#features" class="hash-link" aria-label="Direct link to Features" title="Direct link to Features" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h3>
<table><thead><tr><th>Feature Code</th><th>Feature Name</th><th>Priority</th><th>Status</th></tr></thead><tbody><tr><td>FR-WEA-001</td><td>Location configuration</td><td><span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></td><td><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></td></tr><tr><td>FR-WEA-002</td><td>Current weather retrieval</td><td><span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></td><td><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></td></tr><tr><td>FR-WEA-003</td><td>Weather data caching</td><td><span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></td><td><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></td></tr><tr><td>FR-WEA-004</td><td>Multiple locations</td><td><span class="priorityLabel_hNWY priorityLabelShouldHave_iftn">Should Have</span></td><td><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></td></tr><tr><td>FR-WEA-005</td><td>Unit preferences</td><td><span class="priorityLabel_hNWY priorityLabelShouldHave_iftn">Should Have</span></td><td><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></td></tr><tr><td>FR-WEA-006</td><td>Weather data refresh</td><td><span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></td><td><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></td></tr><tr><td>FR-WEA-007</td><td>Error handling</td><td><span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></td><td><span class="reqStatus_It10 reqStatusDraft_r86d">Draft</span></td></tr></tbody></table>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="fr-wea-001-location-configuration">FR-WEA-001: Location configuration<a href="#fr-wea-001-location-configuration" class="hash-link" aria-label="Direct link to FR-WEA-001: Location configuration" title="Direct link to FR-WEA-001: Location configuration" translate="no">​</a></h3>
<p><strong>Priority:</strong> <span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></p>
<p><strong>Description:</strong><br>
<!-- -->Users must be able to configure locations for weather data retrieval. Locations can be specified by city name,
postal/ZIP code, or geographic coordinates. This configuration is typically stored per widget instance by the Dashboard
Management context but validated by the Weather context.</p>
<p><strong>Preconditions:</strong></p>
<ul>
<li class="">User must be authenticated</li>
<li class="">Weather widget instance must exist on dashboard</li>
<li class="">Location data must be provided (city name, postal code, or coordinates)</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li class="">Location configuration is validated and stored</li>
<li class="">Weather data can be retrieved for the configured location</li>
<li class="">ConfigureWeatherLocation command succeeds</li>
</ul>
<p><strong>Business rules:</strong></p>
<ul>
<li class="">Location must be valid and resolvable by the weather provider</li>
<li class="">Supported location formats: City name (e.g., &quot;London&quot;), City with country (e.g., &quot;London, UK&quot;), Postal/ZIP code,
Geographic coordinates (latitude, longitude)</li>
<li class="">Invalid locations are rejected with appropriate error messages</li>
<li class="">Location validation is performed against weather provider API</li>
<li class="">Default location can be set based on browser geolocation (if permitted)</li>
</ul>
<p><strong>User roles:</strong></p>
<ul>
<li class="">Authenticated User</li>
</ul>
<p><strong>Related to:</strong></p>
<ul>
<li class="">Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
Delivery)</li>
<li class="">Domain Aggregates: WeatherSnapshot (value object), WidgetInstance (from Dashboard Management)</li>
<li class="">Domain Events: WidgetConfigurationChanged (consumed)</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li class="">Dashboard Management context (widget configuration)</li>
<li class="">Weather Provider API (location validation)</li>
</ul>
<p><strong>Acceptance criteria:</strong></p>
<ul>
<li class="">User can configure location via city name</li>
<li class="">User can configure location via postal/ZIP code</li>
<li class="">User can configure location via coordinates</li>
<li class="">Location is validated before saving</li>
<li class="">Invalid locations show appropriate error messages</li>
<li class="">Valid location enables weather data retrieval</li>
<li class="">Location configuration persists across sessions</li>
<li class="">User can update location at any time</li>
</ul>
<p><strong>User stories:</strong></p>
<ul>
<li class="">US-WEA-001-001: Configure location by city name</li>
<li class="">US-WEA-001-002: Configure location by postal code</li>
<li class="">US-WEA-001-003: Validate invalid location</li>
<li class="">US-WEA-001-004: Update existing location</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenarios">Scenarios<a href="#scenarios" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-1-configure-location-by-city-name-happy-path">Scenario 1: Configure location by city name (happy path)<a href="#scenario-1-configure-location-by-city-name-happy-path" class="hash-link" aria-label="Direct link to Scenario 1: Configure location by city name (happy path)" title="Direct link to Scenario 1: Configure location by city name (happy path)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a weather widget on their dashboard<br>
<!-- -->When the user opens widget settings<br>
<!-- -->And enters location &quot;Madrid&quot;<br>
<!-- -->And confirms the change<br>
<!-- -->Then the location is validated against the weather provider<br>
<!-- -->And the location is saved as &quot;Madrid&quot;<br>
<!-- -->And weather data is fetched for Madrid<br>
<!-- -->And the widget displays Madrid weather</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-2-configure-location-with-city-and-country">Scenario 2: Configure location with city and country<a href="#scenario-2-configure-location-with-city-and-country" class="hash-link" aria-label="Direct link to Scenario 2: Configure location with city and country" title="Direct link to Scenario 2: Configure location with city and country" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user is configuring a weather widget<br>
<!-- -->When the user enters location &quot;London, UK&quot;<br>
<!-- -->And confirms the change<br>
<!-- -->Then the location is validated as &quot;London, UK&quot;<br>
<!-- -->And weather data is fetched for London, UK<br>
<!-- -->And the widget displays weather for London, UK</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-3-configure-location-by-postal-code">Scenario 3: Configure location by postal code<a href="#scenario-3-configure-location-by-postal-code" class="hash-link" aria-label="Direct link to Scenario 3: Configure location by postal code" title="Direct link to Scenario 3: Configure location by postal code" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user is configuring a weather widget<br>
<!-- -->When the user enters location &quot;28001&quot; (Madrid postal code)<br>
<!-- -->And confirms the change<br>
<!-- -->Then the location is validated as postal code<br>
<!-- -->And weather data is fetched for the corresponding location<br>
<!-- -->And the widget displays weather with resolved city name</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-4-configure-location-by-coordinates">Scenario 4: Configure location by coordinates<a href="#scenario-4-configure-location-by-coordinates" class="hash-link" aria-label="Direct link to Scenario 4: Configure location by coordinates" title="Direct link to Scenario 4: Configure location by coordinates" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user is configuring a weather widget<br>
<!-- -->When the user enters coordinates &quot;40.4168, -3.7038&quot; (Madrid)<br>
<!-- -->And confirms the change<br>
<!-- -->Then the location is validated as coordinates<br>
<!-- -->And weather data is fetched for those coordinates<br>
<!-- -->And the widget displays weather with resolved city name</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-5-invalid-location-validation">Scenario 5: Invalid location validation<a href="#scenario-5-invalid-location-validation" class="hash-link" aria-label="Direct link to Scenario 5: Invalid location validation" title="Direct link to Scenario 5: Invalid location validation" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user is configuring a weather widget<br>
<!-- -->When the user enters location &quot;InvalidCityXYZ123&quot;<br>
<!-- -->And attempts to save<br>
<!-- -->Then location validation fails<br>
<!-- -->And an error message indicates the location is not found<br>
<!-- -->And the configuration is not saved<br>
<!-- -->And the widget retains previous location (or shows no data)</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-6-update-existing-location">Scenario 6: Update existing location<a href="#scenario-6-update-existing-location" class="hash-link" aria-label="Direct link to Scenario 6: Update existing location" title="Direct link to Scenario 6: Update existing location" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a weather widget configured for &quot;London&quot;<br>
<!-- -->When the user changes the location to &quot;Paris&quot;<br>
<!-- -->And confirms the change<br>
<!-- -->Then the location is updated to &quot;Paris&quot;<br>
<!-- -->And weather data is fetched for Paris<br>
<!-- -->And the widget displays Paris weather<br>
<!-- -->And previous London data is cleared</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-7-use-browser-geolocation-as-default">Scenario 7: Use browser geolocation as default<a href="#scenario-7-use-browser-geolocation-as-default" class="hash-link" aria-label="Direct link to Scenario 7: Use browser geolocation as default" title="Direct link to Scenario 7: Use browser geolocation as default" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user adds a weather widget for the first time<br>
<!-- -->And browser geolocation is permitted<br>
<!-- -->When the widget initializes<br>
<!-- -->Then the system requests user location<br>
<!-- -->And if granted, detects coordinates<br>
<!-- -->And resolves to city name<br>
<!-- -->And sets as default location<br>
<!-- -->And fetches weather data</p></div></div>
<hr>
<p><strong>Technical notes:</strong></p>
<ul>
<li class="">Use weather provider&#x27;s geocoding API for location validation</li>
<li class="">Implement location caching to avoid repeated geocoding requests</li>
<li class="">Store normalized location data (coordinates + resolved city name)</li>
<li class="">Handle ambiguous city names (e.g., &quot;Paris, TX&quot; vs. &quot;Paris, France&quot;)</li>
<li class="">Consider implementing autocomplete for city names (future)</li>
<li class="">Ensure location validation respects API rate limits</li>
</ul>
<p><strong>Open questions:</strong></p>
<ul>
<li class="">Should there be location autocomplete/suggestions during input?</li>
<li class="">Should the system store location history for quick switching?</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="fr-wea-002-current-weather-retrieval">FR-WEA-002: Current weather retrieval<a href="#fr-wea-002-current-weather-retrieval" class="hash-link" aria-label="Direct link to FR-WEA-002: Current weather retrieval" title="Direct link to FR-WEA-002: Current weather retrieval" translate="no">​</a></h3>
<p><strong>Priority:</strong> <span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></p>
<p><strong>Description:</strong><br>
<!-- -->The system must retrieve current weather data from a third-party weather provider API for configured locations. Weather
data includes temperature, conditions (sunny, cloudy, rainy, etc.), humidity, wind speed, and additional metrics. Data
is retrieved on-demand and cached for efficiency.</p>
<p><strong>Preconditions:</strong></p>
<ul>
<li class="">Weather widget must be configured with valid location</li>
<li class="">Weather provider API must be accessible</li>
<li class="">API key/credentials must be valid</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li class="">Current weather data is retrieved from provider</li>
<li class="">WeatherSnapshot is created with provider data</li>
<li class="">WeatherDataRefreshed event is published</li>
<li class="">Weather data is displayed in widget</li>
</ul>
<p><strong>Business rules:</strong></p>
<ul>
<li class="">Weather data includes: temperature (current, feels-like), weather conditions (description + icon code), humidity
percentage, wind speed, atmospheric pressure, provider timestamp</li>
<li class="">Data is retrieved from third-party provider (e.g., OpenWeatherMap, WeatherAPI.com)</li>
<li class="">Provider responses are translated through anti-corruption layer to WeatherSnapshot</li>
<li class="">Weather snapshot must include units (metric/imperial) and timestamp</li>
<li class="">Failed retrievals are handled gracefully (cached data or error state)</li>
</ul>
<p><strong>User roles:</strong></p>
<ul>
<li class="">Authenticated User (indirect; system-initiated)</li>
</ul>
<p><strong>Related to:</strong></p>
<ul>
<li class="">Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
Delivery)</li>
<li class="">Domain Aggregates: WeatherSnapshot (value object)</li>
<li class="">Domain Events: WeatherDataRefreshed, WeatherFetchFailed</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li class="">FR-WEA-001 (Location must be configured)</li>
<li class="">Weather Provider API (external)</li>
</ul>
<p><strong>Acceptance criteria:</strong></p>
<ul>
<li class="">System retrieves current weather from provider API</li>
<li class="">Response is parsed and validated</li>
<li class="">WeatherSnapshot is created with all required fields</li>
<li class="">Temperature is provided in configured units</li>
<li class="">Weather conditions are mapped to standard descriptions</li>
<li class="">Provider timestamp is preserved</li>
<li class="">WeatherDataRefreshed event is published</li>
<li class="">Widget displays weather data</li>
<li class="">Retrieval failures are logged and handled gracefully</li>
</ul>
<p><strong>User stories:</strong></p>
<ul>
<li class="">US-WEA-002-001: Retrieve weather for configured location</li>
<li class="">US-WEA-002-002: Display current temperature</li>
<li class="">US-WEA-002-003: Display weather conditions with icon</li>
<li class="">US-WEA-002-004: Handle weather retrieval failure</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenarios-1">Scenarios<a href="#scenarios-1" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-1-retrieve-weather-for-configured-location-happy-path">Scenario 1: Retrieve weather for configured location (happy path)<a href="#scenario-1-retrieve-weather-for-configured-location-happy-path" class="hash-link" aria-label="Direct link to Scenario 1: Retrieve weather for configured location (happy path)" title="Direct link to Scenario 1: Retrieve weather for configured location (happy path)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a weather widget configured for &quot;Madrid&quot;<br>
<!-- -->When the system fetches weather data<br>
<!-- -->Then a request is sent to the weather provider API<br>
<!-- -->And the response includes current temperature (25°C)<br>
<!-- -->And weather conditions (&quot;Partly Cloudy&quot;)<br>
<!-- -->And humidity (60%)<br>
<!-- -->And wind speed (15 km/h)<br>
<!-- -->And provider timestamp<br>
<!-- -->Then a WeatherSnapshot is created<br>
<!-- -->And a WeatherDataRefreshed event is published<br>
<!-- -->And the widget displays all weather information</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-2-display-temperature-in-metric-units">Scenario 2: Display temperature in metric units<a href="#scenario-2-display-temperature-in-metric-units" class="hash-link" aria-label="Direct link to Scenario 2: Display temperature in metric units" title="Direct link to Scenario 2: Display temperature in metric units" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has configured units as &quot;metric&quot;<br>
<!-- -->And a weather widget for &quot;London&quot;<br>
<!-- -->When weather data is retrieved<br>
<!-- -->Then temperature is displayed in Celsius (18°C)<br>
<!-- -->And wind speed is displayed in km/h (20 km/h)</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-3-display-temperature-in-imperial-units">Scenario 3: Display temperature in imperial units<a href="#scenario-3-display-temperature-in-imperial-units" class="hash-link" aria-label="Direct link to Scenario 3: Display temperature in imperial units" title="Direct link to Scenario 3: Display temperature in imperial units" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has configured units as &quot;imperial&quot;<br>
<!-- -->And a weather widget for &quot;New York&quot;<br>
<!-- -->When weather data is retrieved<br>
<!-- -->Then temperature is displayed in Fahrenheit (75°F)<br>
<!-- -->And wind speed is displayed in mph (12 mph)</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-4-display-weather-icon">Scenario 4: Display weather icon<a href="#scenario-4-display-weather-icon" class="hash-link" aria-label="Direct link to Scenario 4: Display weather icon" title="Direct link to Scenario 4: Display weather icon" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data indicates &quot;Partly Cloudy&quot;<br>
<!-- -->When the widget displays weather<br>
<!-- -->Then an appropriate weather icon is shown<br>
<!-- -->And matches the condition code from provider<br>
<!-- -->And is visually clear and recognizable</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-5-weather-retrieval-failure---api-error">Scenario 5: Weather retrieval failure - API error<a href="#scenario-5-weather-retrieval-failure---api-error" class="hash-link" aria-label="Direct link to Scenario 5: Weather retrieval failure - API error" title="Direct link to Scenario 5: Weather retrieval failure - API error" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a weather widget configured<br>
<!-- -->When the weather provider API returns an error (500)<br>
<!-- -->Then weather retrieval fails<br>
<!-- -->And a WeatherFetchFailed event is published<br>
<!-- -->And cached weather data is displayed (if available)<br>
<!-- -->And a subtle error indicator is shown<br>
<!-- -->And the system retries after backoff period</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-6-weather-retrieval-failure---network-timeout">Scenario 6: Weather retrieval failure - network timeout<a href="#scenario-6-weather-retrieval-failure---network-timeout" class="hash-link" aria-label="Direct link to Scenario 6: Weather retrieval failure - network timeout" title="Direct link to Scenario 6: Weather retrieval failure - network timeout" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a weather widget configured<br>
<!-- -->When the weather provider API request times out<br>
<!-- -->Then weather retrieval fails gracefully<br>
<!-- -->And a WeatherFetchFailed event is published<br>
<!-- -->And the widget shows last known data (if available)<br>
<!-- -->Or shows &quot;Unable to fetch weather&quot; message<br>
<!-- -->And the system retries after backoff period</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-7-parse-provider-response-through-acl">Scenario 7: Parse provider response through ACL<a href="#scenario-7-parse-provider-response-through-acl" class="hash-link" aria-label="Direct link to Scenario 7: Parse provider response through ACL" title="Direct link to Scenario 7: Parse provider response through ACL" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given the weather provider returns data in its specific format<br>
<!-- -->When the system processes the response<br>
<!-- -->Then the anti-corruption layer translates provider format<br>
<!-- -->To WeatherSnapshot internal model<br>
<!-- -->And provider-specific fields are mapped consistently<br>
<!-- -->And the system is isolated from provider API changes</p></div></div>
<hr>
<p><strong>Technical notes:</strong></p>
<ul>
<li class="">Implement anti-corruption layer to isolate from provider-specific data structures</li>
<li class="">Use HTTP client with timeout configuration (e.g., 10 seconds)</li>
<li class="">Implement exponential backoff for retries (e.g., 1s, 2s, 4s)</li>
<li class="">Log all API errors with context for debugging</li>
<li class="">Store provider name and timestamp in WeatherSnapshot</li>
<li class="">Consider using multiple providers for redundancy (future)</li>
<li class="">Ensure API key is stored securely (environment variables, secrets management)</li>
</ul>
<p><strong>Open questions:</strong></p>
<ul>
<li class="">Should there be a fallback provider if primary fails?</li>
<li class="">Should weather data include &quot;feels like&quot; temperature?</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="fr-wea-003-weather-data-caching">FR-WEA-003: Weather data caching<a href="#fr-wea-003-weather-data-caching" class="hash-link" aria-label="Direct link to FR-WEA-003: Weather data caching" title="Direct link to FR-WEA-003: Weather data caching" translate="no">​</a></h3>
<p><strong>Priority:</strong> <span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></p>
<p><strong>Description:</strong><br>
<!-- -->The system must cache weather data to minimize API calls, respect provider rate limits, and improve performance. Cached
data is served to users when fresh data is not available or when cache is still valid. Cache duration balances freshness
with efficiency.</p>
<p><strong>Preconditions:</strong></p>
<ul>
<li class="">Weather data has been retrieved at least once</li>
<li class="">Cache storage is available (in-memory or database)</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li class="">Weather data is cached with timestamp</li>
<li class="">Cached data is served when valid</li>
<li class="">Expired cache triggers fresh retrieval</li>
</ul>
<p><strong>Business rules:</strong></p>
<ul>
<li class="">Weather data is cached for 30 minutes (default, configurable)</li>
<li class="">Cached data includes timestamp of retrieval</li>
<li class="">Expired cache automatically triggers background refresh</li>
<li class="">Cache is per-location (different locations have independent caches)</li>
<li class="">Cache survives application restarts (persisted to database)</li>
<li class="">Manual refresh bypasses cache</li>
</ul>
<p><strong>User roles:</strong></p>
<ul>
<li class="">Authenticated User (indirect; system behavior)</li>
</ul>
<p><strong>Related to:</strong></p>
<ul>
<li class="">Business Requirements: BR-001 (Portfolio Enhancement), BR-003 (Technical Excellence), BR-007 (Cost Efficiency)</li>
<li class="">Domain Aggregates: WeatherSnapshot (value object)</li>
<li class="">Domain Events: WeatherDataRefreshed</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li class="">FR-WEA-002 (Weather retrieval)</li>
<li class="">Cache storage (in-memory or database)</li>
</ul>
<p><strong>Acceptance criteria:</strong></p>
<ul>
<li class="">Weather data is cached after successful retrieval</li>
<li class="">Cache includes location, timestamp, and weather data</li>
<li class="">Cached data is served if cache age &lt; 30 minutes</li>
<li class="">Expired cache triggers automatic background refresh</li>
<li class="">User can manually refresh to bypass cache</li>
<li class="">Cache is persisted to survive application restarts</li>
<li class="">Cache hit rate is logged for monitoring</li>
<li class="">Cache prevents excessive API calls</li>
</ul>
<p><strong>User stories:</strong></p>
<ul>
<li class="">US-WEA-003-001: Serve cached weather data</li>
<li class="">US-WEA-003-002: Refresh expired cache</li>
<li class="">US-WEA-003-003: Manual cache refresh</li>
<li class="">US-WEA-003-004: Cache persists across restarts</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenarios-2">Scenarios<a href="#scenarios-2" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-1-serve-cached-weather-data-happy-path">Scenario 1: Serve cached weather data (happy path)<a href="#scenario-1-serve-cached-weather-data-happy-path" class="hash-link" aria-label="Direct link to Scenario 1: Serve cached weather data (happy path)" title="Direct link to Scenario 1: Serve cached weather data (happy path)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data was fetched for &quot;Madrid&quot; 10 minutes ago<br>
<!-- -->And cached with timestamp<br>
<!-- -->When the widget requests weather data for &quot;Madrid&quot;<br>
<!-- -->Then the system checks cache<br>
<!-- -->And finds valid cached data (age &lt; 30 minutes)<br>
<!-- -->And serves cached data without API call<br>
<!-- -->And no WeatherDataRefreshed event is published</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-2-refresh-expired-cache">Scenario 2: Refresh expired cache<a href="#scenario-2-refresh-expired-cache" class="hash-link" aria-label="Direct link to Scenario 2: Refresh expired cache" title="Direct link to Scenario 2: Refresh expired cache" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data was fetched for &quot;London&quot; 35 minutes ago<br>
<!-- -->And cache has expired (age &gt; 30 minutes)<br>
<!-- -->When the widget requests weather data for &quot;London&quot;<br>
<!-- -->Then the system detects expired cache<br>
<!-- -->And triggers background refresh from provider API<br>
<!-- -->And serves stale cached data immediately (optimistic)<br>
<!-- -->And updates cache when fresh data arrives<br>
<!-- -->And publishes WeatherDataRefreshed event</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-3-manual-refresh-bypasses-cache">Scenario 3: Manual refresh bypasses cache<a href="#scenario-3-manual-refresh-bypasses-cache" class="hash-link" aria-label="Direct link to Scenario 3: Manual refresh bypasses cache" title="Direct link to Scenario 3: Manual refresh bypasses cache" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data was fetched 5 minutes ago (cache valid)<br>
<!-- -->When the user clicks &quot;Refresh&quot; on weather widget<br>
<!-- -->Then the system bypasses cache<br>
<!-- -->And fetches fresh data from provider API<br>
<!-- -->And updates cache with new data<br>
<!-- -->And publishes WeatherDataRefreshed event<br>
<!-- -->And displays updated weather</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-4-cache-miss-triggers-retrieval">Scenario 4: Cache miss triggers retrieval<a href="#scenario-4-cache-miss-triggers-retrieval" class="hash-link" aria-label="Direct link to Scenario 4: Cache miss triggers retrieval" title="Direct link to Scenario 4: Cache miss triggers retrieval" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given no weather data is cached for &quot;Paris&quot;<br>
<!-- -->When the widget requests weather data for &quot;Paris&quot;<br>
<!-- -->Then the system detects cache miss<br>
<!-- -->And fetches data from provider API<br>
<!-- -->And caches the response<br>
<!-- -->And serves the data to widget<br>
<!-- -->And publishes WeatherDataRefreshed event</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-5-cache-prevents-api-rate-limit">Scenario 5: Cache prevents API rate limit<a href="#scenario-5-cache-prevents-api-rate-limit" class="hash-link" aria-label="Direct link to Scenario 5: Cache prevents API rate limit" title="Direct link to Scenario 5: Cache prevents API rate limit" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data is requested frequently<br>
<!-- -->And cache is valid for 30 minutes<br>
<!-- -->When multiple widgets or users request same location<br>
<!-- -->Then cached data is served to all<br>
<!-- -->And only one API call is made per 30-minute window<br>
<!-- -->And API rate limits are respected</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-6-cache-persists-across-application-restarts">Scenario 6: Cache persists across application restarts<a href="#scenario-6-cache-persists-across-application-restarts" class="hash-link" aria-label="Direct link to Scenario 6: Cache persists across application restarts" title="Direct link to Scenario 6: Cache persists across application restarts" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data is cached for &quot;Madrid&quot;<br>
<!-- -->When the application is restarted<br>
<!-- -->And the user views the weather widget<br>
<!-- -->Then cached data is loaded from persistent storage<br>
<!-- -->And displayed immediately<br>
<!-- -->And if cache is expired, background refresh is triggered</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-7-different-locations-have-independent-caches">Scenario 7: Different locations have independent caches<a href="#scenario-7-different-locations-have-independent-caches" class="hash-link" aria-label="Direct link to Scenario 7: Different locations have independent caches" title="Direct link to Scenario 7: Different locations have independent caches" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data is cached for &quot;London&quot; and &quot;Madrid&quot;<br>
<!-- -->When &quot;London&quot; cache expires<br>
<!-- -->Then only &quot;London&quot; data is refreshed<br>
<!-- -->And &quot;Madrid&quot; cache remains valid<br>
<!-- -->And each location is tracked independently</p></div></div>
<hr>
<p><strong>Technical notes:</strong></p>
<ul>
<li class="">Use Redis or in-memory cache (e.g., Caffeine for Java) with TTL (30 minutes)</li>
<li class="">Implement cache key as location identifier (coordinates or normalized city name)</li>
<li class="">Persist cache to database for durability across restarts</li>
<li class="">Implement cache eviction policy (LRU if memory-constrained)</li>
<li class="">Log cache hit/miss rates for monitoring</li>
<li class="">Consider implementing adaptive TTL based on weather stability (future)</li>
<li class="">Ensure thread-safe cache access in multi-threaded environment</li>
</ul>
<p><strong>Open questions:</strong></p>
<ul>
<li class="">Should cache TTL be configurable per location (e.g., shorter for volatile weather)?</li>
<li class="">Should there be a maximum cache size limit?</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="fr-wea-004-multiple-locations">FR-WEA-004: Multiple locations<a href="#fr-wea-004-multiple-locations" class="hash-link" aria-label="Direct link to FR-WEA-004: Multiple locations" title="Direct link to FR-WEA-004: Multiple locations" translate="no">​</a></h3>
<p><strong>Priority:</strong> <span class="priorityLabel_hNWY priorityLabelShouldHave_iftn">Should Have</span></p>
<p><strong>Description:</strong><br>
<!-- -->Users should be able to configure multiple weather widgets for different locations on their dashboard. Each widget
instance maintains its own location configuration and displays weather for that specific location independently.</p>
<p><strong>Preconditions:</strong></p>
<ul>
<li class="">User must be authenticated</li>
<li class="">Dashboard must support multiple widget instances</li>
<li class="">Each widget instance must have unique configuration</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li class="">Multiple weather widgets display different locations</li>
<li class="">Each widget has independent cache</li>
<li class="">Each widget updates independently</li>
</ul>
<p><strong>Business rules:</strong></p>
<ul>
<li class="">Each weather widget instance has its own location configuration</li>
<li class="">Multiple widgets can display the same location (independent instances)</li>
<li class="">Each widget instance has its own cache entry</li>
<li class="">Updates to one widget do not affect others</li>
<li class="">Maximum number of weather widgets per dashboard may be limited (e.g., 5)</li>
</ul>
<p><strong>User roles:</strong></p>
<ul>
<li class="">Authenticated User</li>
</ul>
<p><strong>Related to:</strong></p>
<ul>
<li class="">Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
Delivery)</li>
<li class="">Domain Aggregates: WeatherSnapshot (value object), WidgetInstance (from Dashboard Management)</li>
<li class="">Domain Events: WeatherDataRefreshed (per widget)</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li class="">FR-WEA-001 (Location configuration)</li>
<li class="">FR-WEA-002 (Weather retrieval)</li>
<li class="">FR-WEA-003 (Caching)</li>
<li class="">Dashboard Management context (widget instances)</li>
</ul>
<p><strong>Acceptance criteria:</strong></p>
<ul>
<li class="">User can add multiple weather widgets to dashboard</li>
<li class="">Each widget can be configured with different location</li>
<li class="">Each widget displays its respective location&#x27;s weather</li>
<li class="">Widgets update independently</li>
<li class="">Cache is per-location (shared across widgets for same location)</li>
<li class="">Removing a widget does not affect other widgets</li>
<li class="">Maximum widget limit is enforced (if applicable)</li>
</ul>
<p><strong>User stories:</strong></p>
<ul>
<li class="">US-WEA-004-001: Add multiple weather widgets</li>
<li class="">US-WEA-004-002: Configure different locations for each widget</li>
<li class="">US-WEA-004-003: View multiple locations simultaneously</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenarios-3">Scenarios<a href="#scenarios-3" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-1-add-multiple-weather-widgets-happy-path">Scenario 1: Add multiple weather widgets (happy path)<a href="#scenario-1-add-multiple-weather-widgets-happy-path" class="hash-link" aria-label="Direct link to Scenario 1: Add multiple weather widgets (happy path)" title="Direct link to Scenario 1: Add multiple weather widgets (happy path)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a dashboard<br>
<!-- -->When the user adds a weather widget for &quot;London&quot;<br>
<!-- -->And adds another weather widget for &quot;Tokyo&quot;<br>
<!-- -->And adds a third weather widget for &quot;New York&quot;<br>
<!-- -->Then all three widgets are displayed on the dashboard<br>
<!-- -->And each shows weather for its respective location<br>
<!-- -->And each has independent configuration</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-2-different-locations-update-independently">Scenario 2: Different locations update independently<a href="#scenario-2-different-locations-update-independently" class="hash-link" aria-label="Direct link to Scenario 2: Different locations update independently" title="Direct link to Scenario 2: Different locations update independently" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has weather widgets for &quot;Madrid&quot; and &quot;Paris&quot;<br>
<!-- -->When &quot;Madrid&quot; weather data is refreshed<br>
<!-- -->Then only the Madrid widget updates<br>
<!-- -->And Paris widget retains its current data<br>
<!-- -->And each widget has its own refresh cycle</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-3-same-location-in-multiple-widgets">Scenario 3: Same location in multiple widgets<a href="#scenario-3-same-location-in-multiple-widgets" class="hash-link" aria-label="Direct link to Scenario 3: Same location in multiple widgets" title="Direct link to Scenario 3: Same location in multiple widgets" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user adds two weather widgets for &quot;London&quot;<br>
<!-- -->When weather data for &quot;London&quot; is fetched<br>
<!-- -->Then both widgets display the same data<br>
<!-- -->And data is cached once for &quot;London&quot;<br>
<!-- -->And both widgets serve from same cache<br>
<!-- -->And only one API call is made</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-4-remove-one-widget-others-remain">Scenario 4: Remove one widget, others remain<a href="#scenario-4-remove-one-widget-others-remain" class="hash-link" aria-label="Direct link to Scenario 4: Remove one widget, others remain" title="Direct link to Scenario 4: Remove one widget, others remain" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has three weather widgets<br>
<!-- -->When the user removes the &quot;Tokyo&quot; widget<br>
<!-- -->Then only the Tokyo widget is removed<br>
<!-- -->And &quot;London&quot; and &quot;New York&quot; widgets remain<br>
<!-- -->And their data and configuration are unaffected</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-5-enforce-maximum-widget-limit">Scenario 5: Enforce maximum widget limit<a href="#scenario-5-enforce-maximum-widget-limit" class="hash-link" aria-label="Direct link to Scenario 5: Enforce maximum widget limit" title="Direct link to Scenario 5: Enforce maximum widget limit" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user already has 5 weather widgets (maximum)<br>
<!-- -->When the user attempts to add a 6th weather widget<br>
<!-- -->Then an error message is displayed<br>
<!-- -->And indicates the maximum limit is reached<br>
<!-- -->And the widget is not added</p></div></div>
<hr>
<p><strong>Technical notes:</strong></p>
<ul>
<li class="">Widget instances are managed by Dashboard Management context</li>
<li class="">Weather context provides data based on widget configuration</li>
<li class="">Implement efficient cache sharing for same locations across widgets</li>
<li class="">Ensure widget removal cleans up location-specific state (if last widget for location)</li>
<li class="">Consider implementing widget templates for quick setup (future)</li>
</ul>
<p><strong>Open questions:</strong></p>
<ul>
<li class="">Should there be a recommended/default set of locations?</li>
<li class="">Should removed locations&#x27; cache be immediately cleared or retained?</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="fr-wea-005-unit-preferences">FR-WEA-005: Unit preferences<a href="#fr-wea-005-unit-preferences" class="hash-link" aria-label="Direct link to FR-WEA-005: Unit preferences" title="Direct link to FR-WEA-005: Unit preferences" translate="no">​</a></h3>
<p><strong>Priority:</strong> <span class="priorityLabel_hNWY priorityLabelShouldHave_iftn">Should Have</span></p>
<p><strong>Description:</strong><br>
<!-- -->Users should be able to configure their preferred units for weather data (metric vs. imperial). Unit preferences
determine how temperature, wind speed, and other measurements are displayed. Preferences are typically set globally via
the Preferences context but applied by the Weather context.</p>
<p><strong>Preconditions:</strong></p>
<ul>
<li class="">User must be authenticated</li>
<li class="">Preferences context must be available</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li class="">Weather data is displayed in preferred units</li>
<li class="">Unit conversion is applied correctly</li>
<li class="">Unit preference persists across sessions</li>
</ul>
<p><strong>Business rules:</strong></p>
<ul>
<li class="">Supported units: Metric (Celsius, km/h, mm) and Imperial (Fahrenheit, mph, inches)</li>
<li class="">Default units are metric</li>
<li class="">Unit preference is global (applies to all weather widgets)</li>
<li class="">Unit conversion is applied during data retrieval or display</li>
<li class="">Provider API may support direct unit requests (preferred over conversion)</li>
</ul>
<p><strong>User roles:</strong></p>
<ul>
<li class="">Authenticated User</li>
</ul>
<p><strong>Related to:</strong></p>
<ul>
<li class="">Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
Delivery)</li>
<li class="">Domain Aggregates: WeatherSnapshot (value object)</li>
<li class="">Domain Events: PreferencesUpdated (consumed)</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li class="">FR-WEA-002 (Weather retrieval)</li>
<li class="">Preferences context (unit settings)</li>
</ul>
<p><strong>Acceptance criteria:</strong></p>
<ul>
<li class="">User can set unit preference to metric or imperial</li>
<li class="">Weather data is retrieved in preferred units (if provider supports)</li>
<li class="">If provider doesn&#x27;t support units, conversion is applied</li>
<li class="">Temperature is displayed in Celsius (metric) or Fahrenheit (imperial)</li>
<li class="">Wind speed is displayed in km/h (metric) or mph (imperial)</li>
<li class="">Unit preference persists across sessions</li>
<li class="">Changing preference refreshes all weather widgets</li>
<li class="">Unit labels are displayed correctly (°C, °F, km/h, mph)</li>
</ul>
<p><strong>User stories:</strong></p>
<ul>
<li class="">US-WEA-005-001: Set unit preference to metric</li>
<li class="">US-WEA-005-002: Set unit preference to imperial</li>
<li class="">US-WEA-005-003: Weather updates when preference changes</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenarios-4">Scenarios<a href="#scenarios-4" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-1-set-unit-preference-to-metric-happy-path">Scenario 1: Set unit preference to metric (happy path)<a href="#scenario-1-set-unit-preference-to-metric-happy-path" class="hash-link" aria-label="Direct link to Scenario 1: Set unit preference to metric (happy path)" title="Direct link to Scenario 1: Set unit preference to metric (happy path)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user is in preferences settings<br>
<!-- -->When the user selects &quot;Metric&quot; units<br>
<!-- -->And saves preferences<br>
<!-- -->Then unit preference is set to metric<br>
<!-- -->And a PreferencesUpdated event is published<br>
<!-- -->And all weather widgets refresh<br>
<!-- -->And display temperature in Celsius<br>
<!-- -->And wind speed in km/h</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-2-set-unit-preference-to-imperial">Scenario 2: Set unit preference to imperial<a href="#scenario-2-set-unit-preference-to-imperial" class="hash-link" aria-label="Direct link to Scenario 2: Set unit preference to imperial" title="Direct link to Scenario 2: Set unit preference to imperial" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user is in preferences settings<br>
<!-- -->When the user selects &quot;Imperial&quot; units<br>
<!-- -->And saves preferences<br>
<!-- -->Then unit preference is set to imperial<br>
<!-- -->And a PreferencesUpdated event is published<br>
<!-- -->And all weather widgets refresh<br>
<!-- -->And display temperature in Fahrenheit<br>
<!-- -->And wind speed in mph</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-3-weather-fetched-with-preferred-units">Scenario 3: Weather fetched with preferred units<a href="#scenario-3-weather-fetched-with-preferred-units" class="hash-link" aria-label="Direct link to Scenario 3: Weather fetched with preferred units" title="Direct link to Scenario 3: Weather fetched with preferred units" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has unit preference set to metric<br>
<!-- -->When weather data is fetched from provider<br>
<!-- -->Then the request specifies metric units<br>
<!-- -->And provider returns data in Celsius and km/h<br>
<!-- -->And no conversion is needed<br>
<!-- -->And data is displayed directly</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-4-unit-conversion-when-provider-doesnt-support-preference">Scenario 4: Unit conversion when provider doesn&#x27;t support preference<a href="#scenario-4-unit-conversion-when-provider-doesnt-support-preference" class="hash-link" aria-label="Direct link to Scenario 4: Unit conversion when provider doesn&#x27;t support preference" title="Direct link to Scenario 4: Unit conversion when provider doesn&#x27;t support preference" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a weather provider only returns data in metric<br>
<!-- -->And user preference is imperial<br>
<!-- -->When weather data is retrieved<br>
<!-- -->Then the system receives metric data<br>
<!-- -->And converts temperature to Fahrenheit<br>
<!-- -->And converts wind speed to mph<br>
<!-- -->And displays converted values to user</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-5-unit-preference-persists-across-sessions">Scenario 5: Unit preference persists across sessions<a href="#scenario-5-unit-preference-persists-across-sessions" class="hash-link" aria-label="Direct link to Scenario 5: Unit preference persists across sessions" title="Direct link to Scenario 5: Unit preference persists across sessions" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has set unit preference to imperial<br>
<!-- -->When the user logs out and logs back in<br>
<!-- -->Then unit preference is restored to imperial<br>
<!-- -->And all weather data displays in imperial units</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-6-change-preference-refreshes-widgets">Scenario 6: Change preference refreshes widgets<a href="#scenario-6-change-preference-refreshes-widgets" class="hash-link" aria-label="Direct link to Scenario 6: Change preference refreshes widgets" title="Direct link to Scenario 6: Change preference refreshes widgets" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has weather widgets displaying in metric<br>
<!-- -->When the user changes preference to imperial<br>
<!-- -->Then all weather widgets immediately refresh<br>
<!-- -->And display data in imperial units<br>
<!-- -->And no page reload is required</p></div></div>
<hr>
<p><strong>Technical notes:</strong></p>
<ul>
<li class="">Request units from provider API if supported (e.g., OpenWeatherMap <code>units</code> parameter)</li>
<li class="">Implement unit conversion functions for fallback (Celsius ↔ Fahrenheit, km/h ↔ mph)</li>
<li class="">Store unit preference in user preferences (managed by Preferences context)</li>
<li class="">Weather context consumes PreferencesUpdated event to refresh widgets</li>
<li class="">Ensure unit labels are displayed correctly in UI</li>
<li class="">Consider implementing additional unit systems (e.g., scientific units) in future</li>
</ul>
<p><strong>Open questions:</strong></p>
<ul>
<li class="">Should unit preference be per-widget or global?</li>
<li class="">Should there be quick-toggle for units in widget itself?</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="fr-wea-006-weather-data-refresh">FR-WEA-006: Weather data refresh<a href="#fr-wea-006-weather-data-refresh" class="hash-link" aria-label="Direct link to FR-WEA-006: Weather data refresh" title="Direct link to FR-WEA-006: Weather data refresh" translate="no">​</a></h3>
<p><strong>Priority:</strong> <span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></p>
<p><strong>Description:</strong><br>
<!-- -->The system must support both automatic and manual refresh of weather data. Automatic refresh occurs periodically based
on cache expiration. Manual refresh allows users to get the latest data on-demand. Refresh operations respect API rate
limits and handle failures gracefully.</p>
<p><strong>Preconditions:</strong></p>
<ul>
<li class="">Weather widget must be configured with location</li>
<li class="">Weather provider API must be accessible</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li class="">Weather data is refreshed from provider</li>
<li class="">Cache is updated with new data</li>
<li class="">WeatherDataRefreshed event is published</li>
<li class="">Widget displays updated weather</li>
</ul>
<p><strong>Business rules:</strong></p>
<ul>
<li class="">Automatic refresh occurs when cache expires (default 30 minutes)</li>
<li class="">Manual refresh can be triggered by user at any time</li>
<li class="">Refresh operations respect provider API rate limits</li>
<li class="">Failed refresh retains previous cached data</li>
<li class="">Refresh operations are logged for monitoring</li>
<li class="">Background refresh does not block UI</li>
</ul>
<p><strong>User roles:</strong></p>
<ul>
<li class="">Authenticated User (for manual refresh)</li>
<li class="">System (for automatic refresh)</li>
</ul>
<p><strong>Related to:</strong></p>
<ul>
<li class="">Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-003 (Technical
Excellence)</li>
<li class="">Domain Aggregates: WeatherSnapshot (value object)</li>
<li class="">Domain Events: WeatherDataRefreshed, WeatherFetchFailed</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li class="">FR-WEA-002 (Weather retrieval)</li>
<li class="">FR-WEA-003 (Caching)</li>
</ul>
<p><strong>Acceptance criteria:</strong></p>
<ul>
<li class="">Weather data automatically refreshes when cache expires</li>
<li class="">User can manually refresh via button/action in widget</li>
<li class="">Manual refresh bypasses cache and fetches fresh data</li>
<li class="">Refresh operations are rate-limited (minimum interval)</li>
<li class="">Failed refresh shows appropriate error indication</li>
<li class="">Background refresh does not impact UI responsiveness</li>
<li class="">WeatherDataRefreshed event is published on successful refresh</li>
<li class="">Refresh status is visible to user (loading indicator)</li>
</ul>
<p><strong>User stories:</strong></p>
<ul>
<li class="">US-WEA-006-001: Automatic weather refresh</li>
<li class="">US-WEA-006-002: Manual weather refresh</li>
<li class="">US-WEA-006-003: Refresh with rate limiting</li>
<li class="">US-WEA-006-004: Handle refresh failure</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenarios-5">Scenarios<a href="#scenarios-5" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-1-automatic-weather-refresh-happy-path">Scenario 1: Automatic weather refresh (happy path)<a href="#scenario-1-automatic-weather-refresh-happy-path" class="hash-link" aria-label="Direct link to Scenario 1: Automatic weather refresh (happy path)" title="Direct link to Scenario 1: Automatic weather refresh (happy path)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data was fetched 30 minutes ago<br>
<!-- -->And cache has expired<br>
<!-- -->When the system checks for expired cache<br>
<!-- -->Then automatic refresh is triggered<br>
<!-- -->And fresh weather data is fetched from provider<br>
<!-- -->And cache is updated with new data<br>
<!-- -->And a WeatherDataRefreshed event is published<br>
<!-- -->And all widgets for this location update automatically</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-2-manual-weather-refresh">Scenario 2: Manual weather refresh<a href="#scenario-2-manual-weather-refresh" class="hash-link" aria-label="Direct link to Scenario 2: Manual weather refresh" title="Direct link to Scenario 2: Manual weather refresh" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user is viewing a weather widget<br>
<!-- -->When the user clicks the &quot;Refresh&quot; button<br>
<!-- -->Then a loading indicator is displayed<br>
<!-- -->And fresh weather data is fetched from provider<br>
<!-- -->And cache is updated (bypassing existing cache)<br>
<!-- -->And a WeatherDataRefreshed event is published<br>
<!-- -->And the widget displays updated weather<br>
<!-- -->And loading indicator is hidden</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-3-refresh-with-rate-limiting">Scenario 3: Refresh with rate limiting<a href="#scenario-3-refresh-with-rate-limiting" class="hash-link" aria-label="Direct link to Scenario 3: Refresh with rate limiting" title="Direct link to Scenario 3: Refresh with rate limiting" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user manually refreshed weather 10 seconds ago<br>
<!-- -->When the user attempts to refresh again<br>
<!-- -->Then the refresh is rate-limited<br>
<!-- -->And a message indicates &quot;Please wait before refreshing again&quot;<br>
<!-- -->And no API call is made<br>
<!-- -->And cached data continues to display</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-4-background-refresh-does-not-block-ui">Scenario 4: Background refresh does not block UI<a href="#scenario-4-background-refresh-does-not-block-ui" class="hash-link" aria-label="Direct link to Scenario 4: Background refresh does not block UI" title="Direct link to Scenario 4: Background refresh does not block UI" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given automatic refresh is triggered<br>
<!-- -->When weather data is being fetched in background<br>
<!-- -->Then the UI remains responsive<br>
<!-- -->And the user can interact with other widgets<br>
<!-- -->And a subtle loading indicator shows refresh in progress<br>
<!-- -->And when refresh completes, the widget updates</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-5-refresh-failure-retains-previous-data">Scenario 5: Refresh failure retains previous data<a href="#scenario-5-refresh-failure-retains-previous-data" class="hash-link" aria-label="Direct link to Scenario 5: Refresh failure retains previous data" title="Direct link to Scenario 5: Refresh failure retains previous data" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has weather data from 1 hour ago<br>
<!-- -->When automatic refresh is triggered<br>
<!-- -->And the provider API returns an error<br>
<!-- -->Then the refresh fails<br>
<!-- -->And a WeatherFetchFailed event is published<br>
<!-- -->And previous cached data (1 hour old) continues to display<br>
<!-- -->And a subtle error indicator is shown<br>
<!-- -->And the system schedules retry with backoff</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-6-manual-refresh-during-automatic-refresh">Scenario 6: Manual refresh during automatic refresh<a href="#scenario-6-manual-refresh-during-automatic-refresh" class="hash-link" aria-label="Direct link to Scenario 6: Manual refresh during automatic refresh" title="Direct link to Scenario 6: Manual refresh during automatic refresh" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given automatic refresh is in progress<br>
<!-- -->When the user clicks &quot;Refresh&quot; manually<br>
<!-- -->Then the manual refresh waits for automatic to complete<br>
<!-- -->Or cancels automatic and starts manual refresh<br>
<!-- -->And the user is notified of the operation<br>
<!-- -->And the widget updates when refresh completes</p></div></div>
<hr>
<p><strong>Technical notes:</strong></p>
<ul>
<li class="">Implement refresh scheduler (e.g., scheduled tasks, cron jobs)</li>
<li class="">Use background threads/workers for refresh operations</li>
<li class="">Implement rate limiting (e.g., max 1 refresh per minute per location)</li>
<li class="">Use exponential backoff for failed refreshes (1s, 2s, 4s, 8s, max 60s)</li>
<li class="">Display loading states (skeleton loaders, spinners)</li>
<li class="">Log refresh operations with timestamps and outcomes</li>
<li class="">Consider implementing refresh strategies (polling vs. push via websockets) in future</li>
</ul>
<p><strong>Open questions:</strong></p>
<ul>
<li class="">Should refresh frequency be configurable per widget?</li>
<li class="">Should there be a &quot;Refresh All&quot; button for multiple widgets?</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="fr-wea-007-error-handling">FR-WEA-007: Error handling<a href="#fr-wea-007-error-handling" class="hash-link" aria-label="Direct link to FR-WEA-007: Error handling" title="Direct link to FR-WEA-007: Error handling" translate="no">​</a></h3>
<p><strong>Priority:</strong> <span class="priorityLabel_hNWY priorityLabelMustHave_fw2O">Must Have</span></p>
<p><strong>Description:</strong><br>
<!-- -->The system must handle errors gracefully when weather data retrieval fails. Errors can occur due to network issues, API
failures, invalid configurations, or rate limit exceeded. Error handling ensures a degraded but functional experience
for users.</p>
<p><strong>Preconditions:</strong></p>
<ul>
<li class="">Weather widget is configured</li>
<li class="">Error condition occurs (network, API, configuration)</li>
</ul>
<p><strong>Postconditions:</strong></p>
<ul>
<li class="">Error is detected and classified</li>
<li class="">WeatherFetchFailed event is published</li>
<li class="">User-friendly error message is displayed</li>
<li class="">Cached data is retained (if available)</li>
<li class="">System schedules retry with backoff</li>
</ul>
<p><strong>Business rules:</strong></p>
<ul>
<li class="">Errors are classified by type: Network, API, Configuration, Rate Limit</li>
<li class="">User-friendly error messages are shown (no technical jargon)</li>
<li class="">Cached data is displayed during error states (if available)</li>
<li class="">Errors are logged with context for debugging</li>
<li class="">Retry attempts use exponential backoff</li>
<li class="">Persistent errors (after multiple retries) show degraded state</li>
<li class="">User can manually retry after error</li>
</ul>
<p><strong>User roles:</strong></p>
<ul>
<li class="">Authenticated User</li>
</ul>
<p><strong>Related to:</strong></p>
<ul>
<li class="">Business Requirements: BR-001 (Portfolio Enhancement), BR-003 (Technical Excellence), BR-005 (User Value Delivery)</li>
<li class="">Domain Aggregates: WeatherSnapshot (value object)</li>
<li class="">Domain Events: WeatherFetchFailed</li>
</ul>
<p><strong>Dependencies:</strong></p>
<ul>
<li class="">FR-WEA-002 (Weather retrieval)</li>
<li class="">FR-WEA-003 (Caching)</li>
</ul>
<p><strong>Acceptance criteria:</strong></p>
<ul>
<li class="">Network errors display &quot;Unable to connect&quot; message</li>
<li class="">API errors display &quot;Weather service unavailable&quot; message</li>
<li class="">Invalid configuration errors display &quot;Invalid location&quot; message</li>
<li class="">Rate limit errors display &quot;Please try again in a few minutes&quot; message</li>
<li class="">Cached data is displayed with &quot;Last updated: [time]&quot; note</li>
<li class="">Errors are logged with timestamp, type, and context</li>
<li class="">User can manually retry after error</li>
<li class="">WeatherFetchFailed event is published with error details</li>
<li class="">Persistent errors show contact support or degraded state</li>
</ul>
<p><strong>User stories:</strong></p>
<ul>
<li class="">US-WEA-007-001: Handle network error</li>
<li class="">US-WEA-007-002: Handle API error</li>
<li class="">US-WEA-007-003: Handle invalid configuration</li>
<li class="">US-WEA-007-004: Display cached data during error</li>
</ul>
<hr>
<h4 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenarios-6">Scenarios<a href="#scenarios-6" class="hash-link" aria-label="Direct link to Scenarios" title="Direct link to Scenarios" translate="no">​</a></h4>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-1-handle-network-error-happy-path">Scenario 1: Handle network error (happy path)<a href="#scenario-1-handle-network-error-happy-path" class="hash-link" aria-label="Direct link to Scenario 1: Handle network error (happy path)" title="Direct link to Scenario 1: Handle network error (happy path)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a weather widget configured<br>
<!-- -->When weather data fetch fails due to network timeout<br>
<!-- -->Then the error is classified as &quot;Network Error&quot;<br>
<!-- -->And a WeatherFetchFailed event is published<br>
<!-- -->And an error message &quot;Unable to connect to weather service&quot; is displayed<br>
<!-- -->And cached data is shown (if available) with &quot;Last updated: 1 hour ago&quot;<br>
<!-- -->And the system schedules retry with exponential backoff</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-2-handle-api-error-500">Scenario 2: Handle API error (500)<a href="#scenario-2-handle-api-error-500" class="hash-link" aria-label="Direct link to Scenario 2: Handle API error (500)" title="Direct link to Scenario 2: Handle API error (500)" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has a weather widget configured<br>
<!-- -->When the weather provider API returns 500 Internal Server Error<br>
<!-- -->Then the error is classified as &quot;API Error&quot;<br>
<!-- -->And a WeatherFetchFailed event is published<br>
<!-- -->And an error message &quot;Weather service temporarily unavailable&quot; is displayed<br>
<!-- -->And cached data is retained<br>
<!-- -->And the system schedules retry after 5 minutes</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-3-handle-invalid-location-configuration">Scenario 3: Handle invalid location configuration<a href="#scenario-3-handle-invalid-location-configuration" class="hash-link" aria-label="Direct link to Scenario 3: Handle invalid location configuration" title="Direct link to Scenario 3: Handle invalid location configuration" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a user has configured an invalid location &quot;XYZ12345&quot;<br>
<!-- -->When the system attempts to fetch weather data<br>
<!-- -->Then the error is classified as &quot;Configuration Error&quot;<br>
<!-- -->And a WeatherFetchFailed event is published<br>
<!-- -->And an error message &quot;Invalid location. Please update your settings&quot; is displayed<br>
<!-- -->And no retry is scheduled (configuration issue)<br>
<!-- -->And user is prompted to reconfigure location</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-4-handle-rate-limit-exceeded">Scenario 4: Handle rate limit exceeded<a href="#scenario-4-handle-rate-limit-exceeded" class="hash-link" aria-label="Direct link to Scenario 4: Handle rate limit exceeded" title="Direct link to Scenario 4: Handle rate limit exceeded" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given the weather provider API rate limit has been exceeded<br>
<!-- -->When the system attempts to fetch weather data<br>
<!-- -->Then the error is classified as &quot;Rate Limit Error&quot;<br>
<!-- -->And a WeatherFetchFailed event is published<br>
<!-- -->And an error message &quot;Too many requests. Please try again in a few minutes&quot; is displayed<br>
<!-- -->And cached data is displayed<br>
<!-- -->And retry is scheduled after rate limit reset time</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-5-display-cached-data-during-error">Scenario 5: Display cached data during error<a href="#scenario-5-display-cached-data-during-error" class="hash-link" aria-label="Direct link to Scenario 5: Display cached data during error" title="Direct link to Scenario 5: Display cached data during error" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather data was fetched 2 hours ago<br>
<!-- -->And is cached<br>
<!-- -->When a fetch error occurs<br>
<!-- -->Then the widget displays cached data<br>
<!-- -->And shows &quot;Last updated: 2 hours ago&quot;<br>
<!-- -->And shows a warning icon indicating data may be stale<br>
<!-- -->And user can attempt manual refresh</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-6-manual-retry-after-error">Scenario 6: Manual retry after error<a href="#scenario-6-manual-retry-after-error" class="hash-link" aria-label="Direct link to Scenario 6: Manual retry after error" title="Direct link to Scenario 6: Manual retry after error" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a fetch error has occurred<br>
<!-- -->And error message is displayed<br>
<!-- -->When the user clicks &quot;Retry&quot; button<br>
<!-- -->Then the system attempts to fetch weather data again<br>
<!-- -->And if successful, updates widget and clears error<br>
<!-- -->And if failed again, shows error message and schedules retry</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-7-persistent-error-state">Scenario 7: Persistent error state<a href="#scenario-7-persistent-error-state" class="hash-link" aria-label="Direct link to Scenario 7: Persistent error state" title="Direct link to Scenario 7: Persistent error state" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given weather fetch has failed 5 times consecutively<br>
<!-- -->And exponential backoff has reached maximum<br>
<!-- -->When the next retry also fails<br>
<!-- -->Then the widget displays a persistent error state<br>
<!-- -->And message &quot;Weather service unavailable. Please try again later&quot;<br>
<!-- -->And cached data is shown if available<br>
<!-- -->And user can manually retry at any time</p></div></div>
<h5 class="anchor anchorTargetStickyNavbar_eVCZ" id="scenario-8-error-logging-for-debugging">Scenario 8: Error logging for debugging<a href="#scenario-8-error-logging-for-debugging" class="hash-link" aria-label="Direct link to Scenario 8: Error logging for debugging" title="Direct link to Scenario 8: Error logging for debugging" translate="no">​</a></h5>
<div class="theme-admonition theme-admonition-note admonition_e7Uk alert alert--secondary"><div class="admonitionHeading_RfNA"><span class="admonitionIcon_sa30"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>gherkin</div><div class="admonitionContent_jSlw"><p>Given a weather fetch error occurs<br>
<!-- -->When the error is handled<br>
<!-- -->Then the error is logged with:</p><ul>
<li class="">Timestamp</li>
<li class="">Error type (Network, API, Configuration, Rate Limit)</li>
<li class="">Error details (status code, message)</li>
<li class="">Location being fetched</li>
<li class="">User context (userId, widgetId)<br>
<!-- -->And logs are available for debugging and monitoring</li>
</ul></div></div>
<hr>
<p><strong>Technical notes:</strong></p>
<ul>
<li class="">Implement error classification logic (map HTTP status codes, exceptions to error types)</li>
<li class="">Use structured logging (JSON) for easy parsing and monitoring</li>
<li class="">Implement exponential backoff: 1s, 2s, 4s, 8s, 16s, max 60s</li>
<li class="">Display user-friendly error messages (avoid technical jargon)</li>
<li class="">Retain cached data during errors for graceful degradation</li>
<li class="">Implement error tracking/monitoring (e.g., Sentry, application logs)</li>
<li class="">Consider implementing circuit breaker pattern for persistent failures (future)</li>
</ul>
<p><strong>Open questions:</strong></p>
<ul>
<li class="">Should there be a global error notification system for service-wide issues?</li>
<li class="">Should errors be reported to a monitoring service automatically?</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_eVCZ" id="cross-feature-considerations">Cross-feature considerations<a href="#cross-feature-considerations" class="hash-link" aria-label="Direct link to Cross-feature considerations" title="Direct link to Cross-feature considerations" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="interactions-between-features">Interactions between features<a href="#interactions-between-features" class="hash-link" aria-label="Direct link to Interactions between features" title="Direct link to Interactions between features" translate="no">​</a></h3>
<ul>
<li class=""><strong>Location Configuration ↔ Weather Retrieval:</strong> Valid location enables weather fetching</li>
<li class=""><strong>Weather Retrieval ↔ Caching:</strong> Retrieved data is cached for efficiency</li>
<li class=""><strong>Caching ↔ Refresh:</strong> Expired cache triggers automatic refresh</li>
<li class=""><strong>Multiple Locations ↔ Caching:</strong> Cache is shared for same location across widgets</li>
<li class=""><strong>Unit Preferences ↔ Weather Retrieval:</strong> Units affect how data is requested and displayed</li>
<li class=""><strong>Error Handling ↔ All Features:</strong> Errors can occur in any operation and must be handled gracefully</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="shared-business-rules">Shared business rules<a href="#shared-business-rules" class="hash-link" aria-label="Direct link to Shared business rules" title="Direct link to Shared business rules" translate="no">​</a></h3>
<ol>
<li class=""><strong>Location Validity:</strong> All operations require valid, resolvable locations</li>
<li class=""><strong>API Rate Limiting:</strong> All API operations must respect provider rate limits</li>
<li class=""><strong>Cache Consistency:</strong> Cache must be consistent across multiple widget instances for same location</li>
<li class=""><strong>Unit Consistency:</strong> Units must be applied consistently across all weather data</li>
<li class=""><strong>Error Resilience:</strong> All operations must handle errors gracefully and provide degraded functionality</li>
<li class=""><strong>Event Publishing:</strong> Weather events must be published after successful operations</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="data-consistency-requirements">Data consistency requirements<a href="#data-consistency-requirements" class="hash-link" aria-label="Direct link to Data consistency requirements" title="Direct link to Data consistency requirements" translate="no">​</a></h3>
<ul>
<li class=""><strong>Eventual Consistency:</strong> Weather data can be eventually consistent (cached data tolerated)</li>
<li class=""><strong>Cache Freshness:</strong> Cache expiration ensures data is reasonably fresh (30-minute window)</li>
<li class=""><strong>Location Isolation:</strong> Different locations have independent cache and refresh cycles</li>
<li class=""><strong>Unit Transformation:</strong> Unit conversion is consistent and repeatable</li>
<li class=""><strong>Error State:</strong> Errors do not corrupt cached data; previous valid data is retained</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_eVCZ" id="business-constraints-impact">Business constraints impact<a href="#business-constraints-impact" class="hash-link" aria-label="Direct link to Business constraints impact" title="Direct link to Business constraints impact" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="bc-001-budget">BC-001: Budget<a href="#bc-001-budget" class="hash-link" aria-label="Direct link to BC-001: Budget" title="Direct link to BC-001: Budget" translate="no">​</a></h3>
<p>Weather management must operate within zero-cost infrastructure constraints:</p>
<ul>
<li class=""><strong>Weather Provider:</strong> Use free-tier API (e.g., OpenWeatherMap free plan: 60 calls/minute, 1M calls/month)</li>
<li class=""><strong>Caching:</strong> Use free-tier Redis or in-memory cache (no paid caching service)</li>
<li class=""><strong>Storage:</strong> Use free-tier database for persistent cache (PostgreSQL)</li>
<li class=""><strong>Monitoring:</strong> Use free-tier logging and monitoring tools</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="bc-002-timeline">BC-002: Timeline<a href="#bc-002-timeline" class="hash-link" aria-label="Direct link to BC-002: Timeline" title="Direct link to BC-002: Timeline" translate="no">​</a></h3>
<p>Weather management is on critical path for MVP (3-6 months):</p>
<ul>
<li class=""><strong>Must Have features</strong> (FR-WEA-001, 002, 003, 006, 007) required for MVP</li>
<li class=""><strong>Should Have features</strong> (FR-WEA-004, 005) enhance UX but can be simplified</li>
<li class="">Prioritize single-location support initially; defer multiple locations to post-MVP if needed</li>
<li class="">Use simple in-memory cache initially; defer Redis to post-MVP if needed</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="bc-003-resources">BC-003: Resources<a href="#bc-003-resources" class="hash-link" aria-label="Direct link to BC-003: Resources" title="Direct link to BC-003: Resources" translate="no">​</a></h3>
<p>Single-developer constraints affect Weather management:</p>
<ul>
<li class=""><strong>Leverage Libraries:</strong> Use existing HTTP clients (Axios, Fetch API) and caching libraries</li>
<li class=""><strong>Simplify Provider Integration:</strong> Start with one weather provider (OpenWeatherMap); defer multi-provider support</li>
<li class=""><strong>Automate Testing:</strong> Mock provider API in tests to avoid consuming real API quota</li>
<li class=""><strong>Incremental Development:</strong> Build location config first, then retrieval, then caching, then advanced features</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="bc-004-technology-stack">BC-004: Technology stack<a href="#bc-004-technology-stack" class="hash-link" aria-label="Direct link to BC-004: Technology stack" title="Direct link to BC-004: Technology stack" translate="no">​</a></h3>
<p>Weather management aligns with chosen stack:</p>
<ul>
<li class=""><strong>Frontend:</strong> Angular components for weather widget display</li>
<li class=""><strong>Backend:</strong> Spring Boot REST APIs for weather data retrieval and caching</li>
<li class=""><strong>HTTP Client:</strong> Spring RestTemplate or WebClient for provider API calls</li>
<li class=""><strong>Caching:</strong> Spring Cache abstraction with Caffeine (in-memory) or Redis</li>
<li class=""><strong>Database:</strong> PostgreSQL for persistent cache storage</li>
<li class=""><strong>Error Handling:</strong> Spring exception handling with @ControllerAdvice</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_eVCZ" id="success-metrics-alignment">Success metrics alignment<a href="#success-metrics-alignment" class="hash-link" aria-label="Direct link to Success metrics alignment" title="Direct link to Success metrics alignment" translate="no">​</a></h2>
<p>Weather management contributes to the following success metrics from BR-001 through BR-008:</p>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="br-003-technical-metrics">BR-003: Technical metrics<a href="#br-003-technical-metrics" class="hash-link" aria-label="Direct link to BR-003: Technical metrics" title="Direct link to BR-003: Technical metrics" translate="no">​</a></h3>
<table><thead><tr><th>Metric</th><th>Target</th><th>Weather contribution</th></tr></thead><tbody><tr><td><strong>Page Load Time</strong></td><td>&lt; 2 seconds</td><td>Efficient caching, lazy loading of weather data</td></tr><tr><td><strong>API Response Time</strong></td><td>&lt; 200ms (p95)</td><td>Cached responses, optimized provider API calls</td></tr><tr><td><strong>Test Coverage</strong></td><td>&gt; 80%</td><td>Comprehensive unit/integration tests for all FR-WEA features</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="br-001-portfolio-quality-metrics">BR-001: Portfolio quality metrics<a href="#br-001-portfolio-quality-metrics" class="hash-link" aria-label="Direct link to BR-001: Portfolio quality metrics" title="Direct link to BR-001: Portfolio quality metrics" translate="no">​</a></h3>
<table><thead><tr><th>Metric</th><th>Target</th><th>Weather contribution</th></tr></thead><tbody><tr><td><strong>Architecture Documentation</strong></td><td>All views complete</td><td>Anti-corruption layer design, caching strategy, API integration</td></tr><tr><td><strong>Code Quality Score</strong></td><td>No critical issues</td><td>Clean API integration, proper error handling, testable code</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="br-002-br-005-user-experience-metrics">BR-002, BR-005: User experience metrics<a href="#br-002-br-005-user-experience-metrics" class="hash-link" aria-label="Direct link to BR-002, BR-005: User experience metrics" title="Direct link to BR-002, BR-005: User experience metrics" translate="no">​</a></h3>
<table><thead><tr><th>Metric</th><th>Target</th><th>Weather contribution</th></tr></thead><tbody><tr><td><strong>Task Completion Rate</strong></td><td>&gt; 95%</td><td>Simple location configuration, reliable data display</td></tr><tr><td><strong>Mobile Usability</strong></td><td>Fully Responsive</td><td>Responsive weather widget, touch-friendly controls</td></tr><tr><td><strong>Accessibility Score</strong></td><td>WCAG 2.1 Level AA</td><td>Clear weather information, accessible error messages</td></tr><tr><td><strong>User Satisfaction</strong></td><td>&gt; 4.0/5.0</td><td>Accurate weather data, fast loading, graceful errors</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_eVCZ" id="br-007-cost-efficiency-metrics">BR-007: Cost efficiency metrics<a href="#br-007-cost-efficiency-metrics" class="hash-link" aria-label="Direct link to BR-007: Cost efficiency metrics" title="Direct link to BR-007: Cost efficiency metrics" translate="no">​</a></h3>
<table><thead><tr><th>Metric</th><th>Target</th><th>Weather contribution</th></tr></thead><tbody><tr><td><strong>API Costs</strong></td><td>$0/month</td><td>Free-tier provider, aggressive caching (60 calls/min)</td></tr><tr><td><strong>Infrastructure Costs</strong></td><td>$0/month</td><td>Free-tier database and cache, efficient resource usage</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_eVCZ" id="traceability-matrix">Traceability matrix<a href="#traceability-matrix" class="hash-link" aria-label="Direct link to Traceability matrix" title="Direct link to Traceability matrix" translate="no">​</a></h2>
<table><thead><tr><th>Feature</th><th>Business Req</th><th>Domain Events</th><th>User Stories</th></tr></thead><tbody><tr><td>FR-WEA-001</td><td>BR-001, BR-002, BR-005</td><td>WidgetConfigurationChanged (consumed)</td><td>US-WEA-001-001/002/003/004</td></tr><tr><td>FR-WEA-002</td><td>BR-001, BR-002, BR-005</td><td>WeatherDataRefreshed, WeatherFetchFailed</td><td>US-WEA-002-001/002/003/004</td></tr><tr><td>FR-WEA-003</td><td>BR-001, BR-003, BR-007</td><td>WeatherDataRefreshed</td><td>US-WEA-003-001/002/003/004</td></tr><tr><td>FR-WEA-004</td><td>BR-001, BR-002, BR-005</td><td>WeatherDataRefreshed (per widget)</td><td>US-WEA-004-001/002/003</td></tr><tr><td>FR-WEA-005</td><td>BR-001, BR-002, BR-005</td><td>PreferencesUpdated (consumed)</td><td>US-WEA-005-001/002/003</td></tr><tr><td>FR-WEA-006</td><td>BR-001, BR-002, BR-003</td><td>WeatherDataRefreshed, WeatherFetchFailed</td><td>US-WEA-006-001/002/003/004</td></tr><tr><td>FR-WEA-007</td><td>BR-001, BR-003, BR-005</td><td>WeatherFetchFailed</td><td>US-WEA-007-001/002/003/004</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_Etd2"><a href="https://github.com/migmolrod/browser-dashboard-pwa/tree/master/docs/docs/requirements/functional/weather.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_HVIS" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_HvnU"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/browser-dashboard-pwa/docs/requirements/functional/calendar"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Calendar</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/browser-dashboard-pwa/docs/requirements/functional/user-identity"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User identity</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_ApK3 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#features" class="table-of-contents__link toc-highlight">Features</a><ul><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#fr-wea-001-location-configuration" class="table-of-contents__link toc-highlight">FR-WEA-001: Location configuration</a></li><li><a href="#fr-wea-002-current-weather-retrieval" class="table-of-contents__link toc-highlight">FR-WEA-002: Current weather retrieval</a></li><li><a href="#fr-wea-003-weather-data-caching" class="table-of-contents__link toc-highlight">FR-WEA-003: Weather data caching</a></li><li><a href="#fr-wea-004-multiple-locations" class="table-of-contents__link toc-highlight">FR-WEA-004: Multiple locations</a></li><li><a href="#fr-wea-005-unit-preferences" class="table-of-contents__link toc-highlight">FR-WEA-005: Unit preferences</a></li><li><a href="#fr-wea-006-weather-data-refresh" class="table-of-contents__link toc-highlight">FR-WEA-006: Weather data refresh</a></li><li><a href="#fr-wea-007-error-handling" class="table-of-contents__link toc-highlight">FR-WEA-007: Error handling</a></li></ul></li><li><a href="#cross-feature-considerations" class="table-of-contents__link toc-highlight">Cross-feature considerations</a><ul><li><a href="#interactions-between-features" class="table-of-contents__link toc-highlight">Interactions between features</a></li><li><a href="#shared-business-rules" class="table-of-contents__link toc-highlight">Shared business rules</a></li><li><a href="#data-consistency-requirements" class="table-of-contents__link toc-highlight">Data consistency requirements</a></li></ul></li><li><a href="#business-constraints-impact" class="table-of-contents__link toc-highlight">Business constraints impact</a><ul><li><a href="#bc-001-budget" class="table-of-contents__link toc-highlight">BC-001: Budget</a></li><li><a href="#bc-002-timeline" class="table-of-contents__link toc-highlight">BC-002: Timeline</a></li><li><a href="#bc-003-resources" class="table-of-contents__link toc-highlight">BC-003: Resources</a></li><li><a href="#bc-004-technology-stack" class="table-of-contents__link toc-highlight">BC-004: Technology stack</a></li></ul></li><li><a href="#success-metrics-alignment" class="table-of-contents__link toc-highlight">Success metrics alignment</a><ul><li><a href="#br-003-technical-metrics" class="table-of-contents__link toc-highlight">BR-003: Technical metrics</a></li><li><a href="#br-001-portfolio-quality-metrics" class="table-of-contents__link toc-highlight">BR-001: Portfolio quality metrics</a></li><li><a href="#br-002-br-005-user-experience-metrics" class="table-of-contents__link toc-highlight">BR-002, BR-005: User experience metrics</a></li><li><a href="#br-007-cost-efficiency-metrics" class="table-of-contents__link toc-highlight">BR-007: Cost efficiency metrics</a></li></ul></li><li><a href="#traceability-matrix" class="table-of-contents__link toc-highlight">Traceability matrix</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/browser-dashboard-pwa/docs/intro">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/browser-dashboard-pwa/docs/domain/overview">DMD</a></li><li class="footer__item"><a class="footer__link-item" href="/browser-dashboard-pwa/docs/requirements/overview">SRS</a></li><li class="footer__item"><a class="footer__link-item" href="/browser-dashboard-pwa/docs/architecture/overview">SAD</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/browser-dashboard-pwa/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/migmolrod/browser-dashboard-pwa" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_j3rN"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Miguel Molinero Rodríguez. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>