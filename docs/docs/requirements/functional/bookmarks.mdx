---
sidebar_position: 3
title: Bookmarks
status: Draft
lastUpdated: 2025-11-16
---

import RequirementMetadata from "../../../src/components/RequirementMetadata";
import PriorityLabel from "../../../src/components/PriorityLabel";
import StatusLabel from "../../../src/components/StatusLabel";

<RequirementMetadata status={frontMatter.status} lastUpdated={frontMatter.lastUpdated}/>

# Bookmarks

## Overview

The Bookmarks bounded context manages hierarchical bookmarks (folders and links) and provides quick-access features like
speed dial. It handles the complete lifecycle of bookmark organization, from creation to deletion, while maintaining
folder tree integrity and supplying bookmark data to dashboard widgets.

**Bounded context code:** BKM\
**Related DMD section:** [Bookmarks (Supporting)](../../domain/bounded-contexts/bookmarks)

---

## Features summary

| Feature Code | Feature Name            | Priority                                | Status                        |
|--------------|-------------------------|-----------------------------------------|-------------------------------|
| FR-BKM-001   | Folder Management       | <PriorityLabel priority="Must Have"/>   | <StatusLabel status="Draft"/> |
| FR-BKM-002   | Bookmark Management     | <PriorityLabel priority="Must Have"/>   | <StatusLabel status="Draft"/> |
| FR-BKM-003   | Bookmark Organization   | <PriorityLabel priority="Must Have"/>   | <StatusLabel status="Draft"/> |
| FR-BKM-004   | Bookmark Reordering     | <PriorityLabel priority="Should Have"/> | <StatusLabel status="Draft"/> |
| FR-BKM-005   | Pin/Favorite Management | <PriorityLabel priority="Must Have"/>   | <StatusLabel status="Draft"/> |
| FR-BKM-006   | Bookmark Search         | <PriorityLabel priority="Should Have"/> | <StatusLabel status="Draft"/> |
| FR-BKM-007   | Icon/Favicon Management | <PriorityLabel priority="Should Have"/> | <StatusLabel status="Draft"/> |
| FR-BKM-008   | Speed Dial              | <PriorityLabel priority="Must Have"/>   | <StatusLabel status="Draft"/> |
| FR-BKM-009   | Bookmark Import/Export  | <PriorityLabel priority="Could Have"/>  | <StatusLabel status="Draft"/> |

---

## FR-BKM-001: Folder management

**Priority:** Must Have

**Description:**
Users must be able to create, rename, and delete folders to organize their bookmarks hierarchically. Folders serve as
containers for both bookmarks and other folders (nested hierarchy), enabling flexible organization.

**Preconditions:**

- User must be authenticated
- User must have a root folder (created on user registration)

**Postconditions:**

- Folder is created/renamed/deleted
- Folder tree structure is maintained
- FolderCreated/FolderRenamed/FolderDeleted event is published

**Business rules:**

- Each user has a root folder (automatically created on registration)
- Folder names must be unique within the same parent folder
- Folder names must be non-empty and length-bounded (1-100 characters)
- Folders can be nested (support for hierarchical structure)
- Empty folders can be deleted directly
- Non-empty folders require confirmation and cascade deletion of contents
- Root folder cannot be deleted or renamed

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Folder (root aggregate)
- Domain Events: FolderCreated, FolderRenamed, FolderDeleted, UserRegistered (consumed)

**Dependencies:**

- User Identity context (Conformist relationship)

**Acceptance criteria:**

- User can create a new folder within any existing folder
- Folder is assigned a unique FolderId
- Folder name is validated for uniqueness within parent
- FolderCreated event is published with folderId, name, and parentId
- User can rename folders (except root)
- Renamed folder maintains its position and child elements
- FolderRenamed event is published with folderId and new name
- User can delete empty folders
- Deletion of non-empty folders prompts confirmation and cascades
- FolderDeleted event is published with folderId
- Folder tree structure remains consistent after all operations

**User stories:**

- US-BKM-001-001: Create a new folder
- US-BKM-001-002: Rename a folder
- US-BKM-001-003: Delete an empty folder
- US-BKM-001-004: Delete a folder with contents (cascade)

---

#### Scenarios

##### Scenario 1: Create a new folder (happy path)

```gherkin
Given a user is viewing their bookmarks
When the user selects "New Folder" within the "Work" folder
And enters the name "Projects"
And confirms creation
Then a new folder named "Projects" is created
And the folder is placed within "Work" folder
And a FolderCreated event is published
And the folder appears in the folder tree
```

##### Scenario 2: Create a folder with a duplicate name

```gherkin
Given a user has a folder named "Personal" in the root folder
When the user attempts to create another folder named "Personal" in the root folder
Then validation fails
And an error message indicates the name already exists at this level
And the folder is not created
And no FolderCreated event is published
```

##### Scenario 3: Rename folder

```gherkin
Given a user has a folder named "Temp"
When the user selects "Rename" on the folder
And changes the name to "Archive"
And confirms the change
Then the folder name is updated to "Archive"
And a FolderRenamed event is published
And all child elements remain intact
And the folder's position in the tree is unchanged
```

##### Scenario 4: Delete empty folder

```gherkin
Given a user has an empty folder named "Old"
When the user selects "Delete" on the folder
Then a simple confirmation dialog appears
And upon confirmation, the folder is deleted
And a FolderDeleted event is published
And the folder is removed from the folder tree
```

##### Scenario 5: Delete a folder with contents (cascade)

```gherkin
Given a user has a folder named "Archive" containing 5 bookmarks and 2 subfolders
When the user selects "Delete" on the folder
Then a warning dialog appears indicating the folder contains items
And the dialog shows the count of items that will be deleted
And upon confirmation, the folder and all contents are deleted
And FolderDeleted events are published for the folder and subfolders
And BookmarkDeleted events are published for all bookmarks
And the entire subtree is removed
```

##### Scenario 6: Attempt to rename to duplicate name

```gherkin
Given a user has two folders in root: "Personal" and "Work"
When the user attempts to rename "Personal" to "Work"
Then validation fails
And an error message indicates the name already exists at this level
And the folder name remains unchanged
And no FolderRenamed event is published
```

##### Scenario 7: Create the root folder on user registration

```gherkin
Given a new user has just registered
When the system processes the UserRegistered event
Then a root folder is automatically created for the user
And the root folder has a system-defined name (e.g., "Bookmarks" or "Root")
And a FolderCreated event is published
And the user's bookmark tree is initialized
```

---

**Technical notes:**

- Folder hierarchy should be stored with parent-child relationships (parentId reference)
- Consider limiting nesting depth (e.g., max 10 levels) to prevent performance issues
- Implement efficient tree traversal algorithms for large folder structures
- Cascade deletion should be transactional (all or nothing)
- Consider implementing soft delete for recovery purposes (future)
- Use optimistic locking for concurrent folder modifications

**Open questions:**

- Should there be a maximum nesting depth?
- Should deleted folders be recoverable (trash/recycle bin)?
- Should folder sharing between users be supported (future)?

---

## FR-BKM-002: Bookmark management

**Priority:** Must Have

**Description:**
Users must be able to create, edit, and delete bookmarks. Each bookmark consists of a title, URL, optional icon/favicon,
and belongs to exactly one folder.

**Preconditions:**

- User must be authenticated
- At least one folder must exist
- For editing/deleting: bookmark must exist

**Postconditions:**

- Bookmark is created/updated/deleted
- Bookmark is associated with a folder
- BookmarkCreated/BookmarkUpdated/BookmarkDeleted event is published

**Business rules:**

- Each bookmark must belong to exactly one folder
- URLs must be valid and non-empty
- URL format must be validated (http/https protocol)
- Bookmark titles must be non-empty and length-bounded (1-200 characters)
- Each bookmark has a unique BookmarkId
- Favicon/icon is optional and can be auto-fetched or manually uploaded
- Bookmarks can be moved between folders

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Bookmark, Folder (parent aggregate)
- Domain Events: BookmarkCreated, BookmarkUpdated, BookmarkDeleted

**Dependencies:**

- FR-BKM-001 (Folder must exist)

**Acceptance criteria:**

- User can create a bookmark with URL and title
- URL is validated for proper format
- Bookmark is assigned a unique BookmarkId
- Bookmark is placed in the specified folder
- BookmarkCreated event is published
- User can edit bookmark title and URL
- URL validation is applied on edit
- BookmarkUpdated event is published
- User can delete bookmarks
- Confirmation is required before deletion
- BookmarkDeleted event is published
- Deleted bookmark is removed from its folder

**User stories:**

- US-BKM-002-001: Create a new bookmark
- US-BKM-002-002: Edit a bookmark
- US-BKM-002-003: Delete a bookmark
- US-BKM-002-004: Move a bookmark to another folder

---

#### Scenarios

##### Scenario 1: Create new bookmark (happy path)

```gherkin
Given a user is viewing the "Work" folder
When the user selects "Add Bookmark"
And enters the URL "https://github.com"
And enters the title "GitHub"
And confirms creation
Then a new bookmark is created
And the bookmark is placed in the "Work" folder
And the favicon is automatically fetched from the URL
And a BookmarkCreated event is published
And the bookmark appears in the folder
```

##### Scenario 2: Create bookmark with invalid URL

```gherkin
Given a user is creating a bookmark
When the user enters an invalid URL "not-a-url"
And attempts to save
Then URL validation fails
And an error message indicates the URL format is invalid
And the bookmark is not created
And no BookmarkCreated event is published
```

##### Scenario 3: Edit bookmark

```gherkin
Given a user has a bookmark with title "Old Title" and URL "https://old-url.com"
When the user selects "Edit" on the bookmark
And changes the title to "New Title"
And changes the URL to "https://new-url.com"
And confirms the changes
Then the bookmark is updated with the new values
And a BookmarkUpdated event is published
And the favicon is refreshed from the new URL
And the bookmark position remains unchanged
```

##### Scenario 4: Delete bookmark

```gherkin
Given a user has a bookmark in the "Work" folder
When the user selects "Delete" on the bookmark
Then a confirmation dialog appears
And upon confirmation, the bookmark is deleted
And a BookmarkDeleted event is published
And the bookmark is removed from the folder
```

##### Scenario 5: Move bookmark to another folder

```gherkin
Given a user has a bookmark in the "Personal" folder
When the user drags the bookmark to the "Work" folder
Then the bookmark is moved to the "Work" folder
And a BookmarkUpdated event is published indicating folder change
And the bookmark appears in the "Work" folder
And the bookmark is removed from the "Personal" folder
```

##### Scenario 6: Create bookmark without title

```gherkin
Given a user is creating a bookmark
When the user enters a URL "https://example.com"
**But** leaves the title field empty
And attempts to save
Then validation fails
And an error message indicates the title is required
And the bookmark is not created
And no BookmarkCreated event is published
```

##### Scenario 7: Auto-fetch favicon fails

```gherkin
Given a user creates a bookmark with URL "https://no-favicon.com"
When the favicon auto-fetch fails
Then a default icon is assigned to the bookmark
And the bookmark is created successfully
And a BookmarkCreated event is published
And the user can later upload a custom icon
```

---

**Technical notes:**

- URL validation should check protocol (http/https), domain, and basic format
- Consider implementing URL normalization (remove trailing slashes, lowercase domain)
- Favicon fetching should be asynchronous and non-blocking
- Implement retry logic for favicon fetching
- Consider caching favicons to reduce external requests
- Use optimistic locking for concurrent bookmark updates
- Ensure bookmark URLs are XSS-safe (sanitize inputs)

**Open questions:**

- Should duplicate URLs be allowed in the same folder?
- Should there be a character limit for URLs (e.g., 2000 characters)?
- Should bookmark descriptions be added (future)?

---

## FR-BKM-003: Bookmark organization

**Priority:** Must Have

**Description:**
Users must be able to organize bookmarks by moving them between folders and maintaining a logical structure. This
feature complements folder and bookmark management by enabling flexible reorganization.

**Preconditions:**

- User must be authenticated
- Bookmark must exist
- Target folder must exist

**Postconditions:**

- Bookmark is moved to target folder
- Folder tree structure is maintained
- BookmarkUpdated event is published

**Business rules:**

- A bookmark can only belong to one folder at a time
- Moving a bookmark updates its parent folder reference
- Moving a bookmark does not change its position within the new folder (appended to end)
- Bookmarks can be moved to any folder (except implicitly invalid moves)
- Moving operations must be atomic

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Bookmark, Folder
- Domain Events: BookmarkUpdated

**Dependencies:**

- FR-BKM-001 (Folders must exist)
- FR-BKM-002 (Bookmark must exist)

**Acceptance criteria:**

- User can move a bookmark to a different folder via drag-and-drop
- User can move a bookmark via context menu "Move to..."
- Target folder is validated before move
- Bookmark is removed from source folder
- Bookmark is added to target folder
- BookmarkUpdated event is published with folder change
- Bookmark order is preserved in source folder (remaining bookmarks shift)
- Bookmark is appended to end of target folder

**User stories:**

- US-BKM-003-001: Move bookmark via drag-and-drop
- US-BKM-003-002: Move bookmark via context menu
- US-BKM-003-003: Move multiple bookmarks at once (future)

---

#### Scenarios

##### Scenario 1: Move bookmark via drag-and-drop (happy path)

```gherkin
Given a user has a bookmark in the "Personal" folder
When the user drags the bookmark over the "Work" folder
And releases the mouse button
Then the bookmark is moved to the "Work" folder
And a BookmarkUpdated event is published
And the bookmark appears at the end of the "Work" folder
And the bookmark is removed from the "Personal" folder
```

##### Scenario 2: Move bookmark via context menu

```gherkin
Given a user right-clicks a bookmark in the "Personal" folder
When the user selects "Move to..." from the context menu
And selects "Work" folder from the folder list
Then the bookmark is moved to the "Work" folder
And a BookmarkUpdated event is published
And the bookmark appears at the end of the "Work" folder
```

##### Scenario 3: Cancel drag operation

```gherkin
Given a user starts dragging a bookmark
When the user presses the ESC key before releasing
Then the drag operation is cancelled
And the bookmark remains in its original folder
And no BookmarkUpdated event is published
```

##### Scenario 4: Drop bookmark on invalid target

```gherkin
Given a user is dragging a bookmark
When the user releases the bookmark outside any folder area
Then the bookmark snaps back to its original position
And no move operation occurs
And no BookmarkUpdated event is published
```

---

**Technical notes:**

- Implement visual feedback during drag operations (ghost image, drop zones)
- Use optimistic UI updates for perceived performance
- Ensure atomic transaction for move operations
- Consider implementing undo/redo for move operations
- Drag-and-drop should work on both desktop and touch devices

**Open questions:**

- Should there be a limit on how many bookmarks can be moved at once?
- Should move operations support undo?

---

## FR-BKM-004: Bookmark reordering

**Priority:** Should Have

**Description:**
Users should be able to reorder bookmarks within a folder to prioritize frequently used links or organize by preference.
Reordering provides stable, user-defined ordering independent of creation date or alphabetical sorting.

**Preconditions:**

- User must be authenticated
- Folder must contain at least two bookmarks

**Postconditions:**

- Bookmark positions are updated within the folder
- New order is persisted
- BookmarkUpdated event is published (or BookmarkReordered if distinct)

**Business rules:**

- Bookmarks have a stable order within each folder
- Reordering only affects bookmarks within the same folder
- Order is user-defined (not alphabetical or date-based by default)
- Reordering must be atomic
- Order positions are total (no gaps)

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Bookmark, Folder
- Domain Events: BookmarkUpdated (or BookmarkReordered)

**Dependencies:**

- FR-BKM-002 (Bookmarks must exist)

**Acceptance criteria:**

- User can drag-and-drop bookmarks to reorder them within a folder
- Visual feedback shows the bookmark being dragged
- Drop zones between bookmarks are indicated
- Bookmark order is updated when dropped
- Other bookmarks shift to accommodate the moved bookmark
- BookmarkUpdated event is published with new position
- Order is persisted immediately
- Reordering can be cancelled (ESC key or drop outside)

**User stories:**

- US-BKM-004-001: Reorder bookmarks via drag-and-drop
- US-BKM-004-002: Cancel reorder operation

---

#### Scenarios

##### Scenario 1: Reorder bookmarks via drag-and-drop (happy path)

```gherkin
Given a folder contains bookmarks in order: A, B, C, D
When the user drags bookmark D to the position between A and B
Then bookmark D is visually lifted and follows the cursor
And drop zones between bookmarks are highlighted
And when dropped, the order becomes: A, D, B, C
And a BookmarkUpdated event is published
And the new order is persisted
```

##### Scenario 2: Move bookmark to the first position

```gherkin
Given a folder contains bookmarks in order: A, B, C
When the user drags bookmark C to the first position
Then the order becomes: C, A, B
And a BookmarkUpdated event is published
And the change is persisted
```

##### Scenario 3: Cancel reorder operation

```gherkin
Given a user starts dragging a bookmark
When the user presses the ESC key before dropping
Then the drag operation is cancelled
And the bookmark returns to its original position
And no BookmarkUpdated event is published
```

---

**Technical notes:**

- Store bookmark order as an explicit position field (integer)
- Implement efficient reordering algorithm (update only affected positions)
- Use smooth animations for drag-and-drop feedback
- Support touch devices for reordering
- Consider implementing keyboard-based reordering for accessibility

**Open questions:**

- Should there be alternative reordering mechanisms (buttons, keyboard)?
- Should automatic sorting options be provided (alphabetical, most-used)?

---

## FR-BKM-005: Pin/favorite management

**Priority:** Must Have

**Description:**
Users must be able to pin or mark bookmarks as favorites for quick access via speed dial or prominent display. Pinned
bookmarks are highlighted and easily accessible regardless of their folder location.

**Preconditions:**

- User must be authenticated
- Bookmark must exist

**Postconditions:**

- Bookmark pin status is updated
- BookmarkPinned or BookmarkUnpinned event is published
- Speed dial is updated (if applicable)

**Business rules:**

- Bookmarks can be pinned or unpinned independently of their folder location
- Pinned bookmarks remain in their original folder
- There may be a maximum number of pinned bookmarks (e.g., 12 for speed dial grid)
- Pinning does not affect bookmark order within folder
- Pinned bookmarks have a separate display area or visual indicator

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Bookmark
- Domain Events: BookmarkPinned, BookmarkUnpinned

**Dependencies:**

- FR-BKM-002 (Bookmark must exist)

**Acceptance criteria:**

- User can pin a bookmark via context menu or button
- Pinned bookmark is marked with visual indicator
- BookmarkPinned event is published
- Pinned bookmark appears in speed dial
- User can unpin a bookmark
- BookmarkUnpinned event is published
- Unpinned bookmark is removed from speed dial
- Attempting to pin beyond maximum shows error message
- Pinned status persists across sessions

**User stories:**

- US-BKM-005-001: Pin a bookmark
- US-BKM-005-002: Unpin a bookmark
- US-BKM-005-003: View pinned bookmarks in speed dial

---

#### Scenarios

##### Scenario 1: Pin a bookmark (happy path)

```gherkin
Given a user has a bookmark in the "Work" folder
And the bookmark is not currently pinned
When the user right-clicks the bookmark
And selects "Pin to Speed Dial"
Then the bookmark is marked as pinned
And a BookmarkPinned event is published
And the bookmark appears in the speed dial
And a pin icon is displayed on the bookmark
```

##### Scenario 2: Unpin a bookmark

```gherkin
Given a user has a pinned bookmark
When the user right-clicks the bookmark
And selects "Unpin from Speed Dial"
Then the bookmark is unmarked as pinned
And a BookmarkUnpinned event is published
And the bookmark is removed from the speed dial
And the pin icon is removed
```

##### Scenario 3: Attempt to pin when maximum reached

```gherkin
Given a user has already pinned 12 bookmarks (maximum)
When the user attempts to pin another bookmark
Then an error message appears indicating the limit is reached
And the bookmark is not pinned
And no BookmarkPinned event is published
```

##### Scenario 4: Pin status persists across sessions

```gherkin
Given a user has pinned 5 bookmarks
When the user logs out and logs back in
Then the 5 bookmarks remain pinned
And they appear in the speed dial
And the pin indicators are displayed
```

---

**Technical notes:**

- Store pin status as a boolean field on Bookmark entity
- Consider storing pin order for consistent speed dial layout
- Implement maximum pin limit validation
- Speed dial should update in real-time when bookmarks are pinned/unpinned
- Consider implementing pin priority or custom ordering

**Open questions:**

- Should pinned bookmarks have a custom order in speed dial?
- Should the maximum number of pins be configurable?

---

## FR-BKM-006: Bookmark search

**Priority:** Should Have

**Description:**
Users should be able to search their bookmarks by title, URL, or folder name to quickly locate specific links. Search
provides fast access without manual navigation through folder hierarchy.

**Preconditions:**

- User must be authenticated
- User must have at least one bookmark

**Postconditions:**

- Search results are displayed
- Results are ranked by relevance
- Search can be cleared to return to folder view

**Business rules:**

- Search is case-insensitive
- Search matches partial strings (substring matching)
- Search includes bookmark titles, URLs, and folder names
- Results show matching bookmarks regardless of folder location
- Search results are updated in real-time as user types
- Empty search returns all bookmarks or clears search

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Bookmark, Folder
- Domain Events: None (read-only operation)

**Dependencies:**

- FR-BKM-002 (Bookmarks must exist)

**Acceptance criteria:**

- User can enter search query in search field
- Search results update in real-time as user types
- Results show matching bookmarks with title and URL
- Matching text is highlighted in results
- Results show folder path for context
- Clicking a result opens the bookmark
- Search can be cleared to return to normal view
- Empty search shows no results or all bookmarks

**User stories:**

- US-BKM-006-001: Search bookmarks by title
- US-BKM-006-002: Search bookmarks by URL
- US-BKM-006-003: Clear search

---

#### Scenarios

##### Scenario 1: Search bookmarks by title (happy path)

```gherkin
Given a user has bookmarks with various titles
When the user enters "github" in the search field
Then all bookmarks with "github" in the title are displayed
And the matching text "github" is highlighted
And each result shows the bookmark title, URL, and folder path
And results update in real-time as the user types
```

##### Scenario 2: Search bookmarks by URL

```gherkin
Given a user has bookmarks with various URLs
When the user enters "stackoverflow.com" in the search field
Then all bookmarks with "stackoverflow.com" in the URL are displayed
And the matching text is highlighted in the URL
And results show the folder location
```

##### Scenario 3: No search results

```gherkin
Given a user enters a search query
When no bookmarks match the query
Then a "No results found" message is displayed
And the search field remains active
And the user can modify the query
```

##### Scenario 4: Clear search

```gherkin
Given a user has entered a search query with results displayed
When the user clicks the "Clear" button
Then the search field is cleared
And the normal folder view is restored
And all bookmarks in the current folder are displayed
```

##### Scenario 5: Search with special characters

```gherkin
Given a user has bookmarks with special characters in titles
When the user searches for those special characters
Then the search correctly handles and escapes special characters
And matching bookmarks are displayed
And no errors occur
```

---

**Technical notes:**

- Implement debouncing for search input (e.g., 300ms) to reduce query load
- Use full-text search or indexed search for performance
- Consider implementing search result ranking (exact match > starts with > contains)
- Highlight matching text using markup or CSS
- Implement efficient search algorithm for large bookmark collections
- Consider implementing search filters (folder, date added, pinned status)

**Open questions:**

- Should search support regular expressions or advanced query syntax?
- Should search history be saved?
- Should search include bookmark tags/descriptions (future)?

---

## FR-BKM-007: Icon/favicon management

**Priority:** Should Have

**Description:**
The system should automatically fetch and display favicons for bookmarks, with the ability for users to manually upload
custom icons. Icons enhance visual recognition and improve user experience.

**Preconditions:**

- Bookmark must exist
- For auto-fetch: URL must be valid and accessible

**Postconditions:**

- Favicon is fetched and stored
- Bookmark displays the icon
- Fallback icon is used if fetch fails

**Business rules:**

- Favicons are automatically fetched when bookmarks are created
- Favicon fetching is asynchronous and non-blocking
- Failed fetches use a default fallback icon
- Users can manually upload custom icons (override auto-fetched)
- Icon file size is limited (e.g., max 100KB)
- Supported formats: PNG, JPG, ICO, SVG
- Icons are cached to reduce external requests

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Bookmark
- Domain Events: BookmarkUpdated (when icon changes)

**Dependencies:**

- FR-BKM-002 (Bookmark must exist)

**Acceptance criteria:**

- Favicon is automatically fetched when bookmark is created
- Fetching occurs in background (non-blocking)
- Default icon is displayed during fetch
- Fetched favicon replaces default when available
- Failed fetches retain default icon
- User can upload custom icon via bookmark settings
- Uploaded icon replaces auto-fetched icon
- Icon file size and format are validated
- Icons are cached and reused for same domain

**User stories:**

- US-BKM-007-001: Auto-fetch favicon on bookmark creation
- US-BKM-007-002: Upload custom icon
- US-BKM-007-003: Revert to auto-fetched icon

---

#### Scenarios

##### Scenario 1: Auto-fetch favicon on bookmark creation (happy path)

```gherkin
Given a user creates a bookmark with URL "https://github.com"
When the bookmark is saved
Then the system immediately displays a default icon
And the system asynchronously fetches the favicon from "https://github.com/favicon.ico"
And when the fetch succeeds, the favicon replaces the default icon
And the favicon is cached for future use
```

##### Scenario 2: Favicon fetch fails

```gherkin
Given a user creates a bookmark with URL "https://no-favicon-site.com"
When the bookmark is saved
And the favicon fetch fails (404 or timeout)
Then the default icon is retained
And the fetch failure is logged
And the user can later upload a custom icon
```

##### Scenario 3: Upload custom icon

```gherkin
Given a user has a bookmark with an auto-fetched favicon
When the user opens bookmark settings
And selects "Upload Custom Icon"
And uploads a PNG file (< 100KB)
Then the file is validated for size and format
And the custom icon is stored
And the custom icon replaces the auto-fetched favicon
And a BookmarkUpdated event is published
```

##### Scenario 4: Upload invalid icon file

```gherkin
Given a user attempts to upload a custom icon
When the file size exceeds 100KB
Then validation fails
And an error message indicates the file is too large
And the icon is not uploaded
And the current icon remains unchanged
```

##### Scenario 5: Revert to auto-fetched icon

```gherkin
Given a user has uploaded a custom icon
When the user selects "Use Auto-Fetched Icon"
Then the custom icon is removed
And the system re-fetches the favicon from the URL
And the auto-fetched icon is displayed
And a BookmarkUpdated event is published
```

---

**Technical notes:**

- Use a favicon service or library for reliable fetching (e.g., Google favicon service as fallback)
- Implement retry logic with exponential backoff for failed fetches
- Cache favicons by domain to avoid redundant fetches
- Implement lazy loading for icons in large bookmark lists
- Use image optimization (compression, resizing) for uploaded icons
- Consider implementing icon versioning for cache invalidation

**Open questions:**

- Should favicons be refreshed periodically?
- Should there be a "Refresh Icon" option for users?

---

## FR-BKM-008: Speed dial

**Priority:** Must Have

**Description:**
Users must be able to view their pinned bookmarks in a visual grid (speed dial) for quick access. Speed dial provides a
Chrome-like new tab experience with favorite bookmarks prominently displayed.

**Preconditions:**

- User must be authenticated
- At least one bookmark must be pinned

**Postconditions:**

- Speed dial displays pinned bookmarks in grid layout
- Grid is responsive and adapts to screen size
- Clicking a bookmark opens the URL

**Business rules:**

- Speed dial shows only pinned bookmarks
- Grid layout adapts to screen size (e.g., 4x3 on desktop, 3x4 on tablet, 2xN on mobile)
- Maximum number of pinned bookmarks determines grid size
- Empty speed dial shows instructions to pin bookmarks
- Speed dial can be embedded in dashboard widget or standalone page
- Bookmarks in speed dial show icon and title

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-002 (User Productivity Enhancement), BR-005 (User Value
  Delivery)
- Domain Aggregates: Bookmark
- Domain Events: None (read-only view)

**Dependencies:**

- FR-BKM-005 (Pinned bookmarks)

**Acceptance criteria:**

- Speed dial displays pinned bookmarks in grid layout
- Grid is responsive (adapts to screen size)
- Each bookmark tile shows icon and title
- Clicking a bookmark opens URL in new tab
- Empty speed dial shows placeholder with instructions
- Speed dial updates in real-time when bookmarks are pinned/unpinned
- Grid layout is visually appealing and consistent
- Hover effects provide visual feedback

**User stories:**

- US-BKM-008-001: View speed dial with pinned bookmarks
- US-BKM-008-002: Open bookmark from speed dial
- US-BKM-008-003: View empty speed dial

---

#### Scenarios

##### Scenario 1: View speed dial with pinned bookmarks (happy path)

```gherkin
Given a user has pinned 8 bookmarks
When the user views the speed dial
Then all 8 bookmarks are displayed in a grid layout
And each bookmark shows its icon and title
And the grid adapts to the screen size
And hover effects highlight the bookmark tile
```

##### Scenario 2: Open bookmark from speed dial

```gherkin
Given a user is viewing the speed dial
When the user clicks on a bookmark tile
Then the bookmark URL opens in a new browser tab
And the speed dial remains open
```

##### Scenario 3: View empty speed dial

```gherkin
Given a user has no pinned bookmarks
When the user views the speed dial
Then a placeholder message is displayed
And the message says "Pin bookmarks to add them here"
And a button or link to bookmark management is provided
```

##### Scenario 4: Speed dial updates in real-time

```gherkin
Given a user is viewing the speed dial
When the user pins a new bookmark from another window/tab
Then the speed dial automatically updates
And the new bookmark appears in the grid
And no page refresh is required
```

##### Scenario 5: Responsive grid layout

```gherkin
Given a user is viewing the speed dial on desktop
When the user resizes the browser window to tablet size
Then the grid layout adapts to show fewer columns
And all pinned bookmarks remain visible
And the transition is smooth
```

---

**Technical notes:**

- Use CSS Grid or Flexbox for responsive layout
- Implement lazy loading for bookmark icons
- Use animations for hover effects and tile interactions
- Consider implementing drag-and-drop for reordering speed dial items
- Optimize for performance with large numbers of pinned bookmarks
- Implement accessibility features (keyboard navigation, ARIA labels)

**Open questions:**

- Should speed dial support custom ordering (independent of pin order)?
- Should there be different speed dial views (grid size options)?

---

## FR-BKM-009: Bookmark import/export

**Priority:** Could Have

**Description:**
Users could have the ability to import bookmarks from other browsers or files and export their bookmarks for backup or
migration. This feature enhances portability and reduces migration friction.

**Preconditions:**

- User must be authenticated
- For import: valid bookmark file must be provided
- For export: at least one bookmark must exist

**Postconditions:**

- Imported bookmarks are added to folder hierarchy
- Exported file contains all bookmarks in standard format
- Import/export operations are logged

**Business rules:**

- Supported import formats: HTML (Netscape Bookmark File), JSON
- Supported export formats: HTML, JSON
- Import preserves folder hierarchy when possible
- Duplicate bookmarks (same URL) can be skipped or imported based on user preference
- Import is transactional (all or nothing)
- Export includes all bookmarks and folders
- Exported files are timestamped

**User roles:**

- Authenticated User

**Related to:**

- Business Requirements: BR-001 (Portfolio Enhancement), BR-005 (User Value Delivery), BR-006 (Developer Experience)
- Domain Aggregates: Bookmark, Folder
- Domain Events: BookmarkCreated, FolderCreated (for imports)

**Dependencies:**

- FR-BKM-001 (Folder management)
- FR-BKM-002 (Bookmark management)

**Acceptance criteria:**

- User can upload bookmark file (HTML or JSON)
- File format is validated
- Import preview shows number of bookmarks and folders
- User can choose to skip duplicates or import all
- Import is transactional (fails entirely if errors occur)
- BookmarkCreated and FolderCreated events are published for imports
- User can export all bookmarks to HTML or JSON
- Export file is downloadable
- Export includes folder hierarchy
- Export file is named with timestamp

**User stories:**

- US-BKM-009-001: Import bookmarks from file
- US-BKM-009-002: Export bookmarks to file
- US-BKM-009-003: Handle duplicate bookmarks on import

---

#### Scenarios

##### Scenario 1: Import bookmarks from HTML file (happy path)

```gherkin
Given a user has a bookmark HTML file from another browser
When the user selects "Import Bookmarks"
And uploads the HTML file
Then the file is validated
And an import preview shows the number of bookmarks and folders
And the user confirms the import
And all bookmarks and folders are created
And BookmarkCreated and FolderCreated events are published
And a success message is displayed
```

##### Scenario 2: Export bookmarks to JSON

```gherkin
Given a user has bookmarks organized in folders
When the user selects "Export Bookmarks"
And chooses JSON format
Then a JSON file is generated containing all bookmarks and folders
And the file is named with timestamp (e.g., "bookmarks_2025-11-15.json")
And the file is downloaded to the user's device
```

##### Scenario 3: Import with duplicate handling

```gherkin
Given a user already has bookmarks with URLs that exist in the import file
When the user imports the file
Then a dialog asks whether to skip duplicates or import all
And if "Skip Duplicates" is selected, only new bookmarks are imported
And if "Import All" is selected, duplicates are imported (possibly in a different folder)
```

##### Scenario 4: Import invalid file

```gherkin
Given a user attempts to import a file
When the file is not a valid HTML or JSON bookmark file
Then validation fails
And an error message indicates the file format is invalid
And no bookmarks are imported
```

##### Scenario 5: Import fails mid-operation

```gherkin
Given a user is importing a large bookmark file
When an error occurs during import (e.g., database error)
Then the entire import is rolled back
And no partial bookmarks are created
And an error message is displayed with details
```

---

**Technical notes:**

- Use a library for parsing HTML bookmark files (e.g., Cheerio for Node.js)
- Implement JSON schema validation for JSON imports
- Use transactions to ensure atomic imports
- Consider implementing progress indicators for large imports
- Implement file size limits for uploads (e.g., max 10MB)
- Consider implementing import from browser APIs (future)

**Open questions:**

- Should there be an option to import into a specific folder?
- Should export include only selected folders or always all bookmarks?

---

## Cross-feature considerations

### Interactions between features

- **Folder Management ↔ Bookmark Management:** Bookmarks must belong to folders; deleting folders cascades to bookmarks
- **Bookmark Management ↔ Icon Management:** Creating/editing bookmarks triggers favicon fetching
- **Pin Management ↔ Speed Dial:** Pinning bookmarks updates speed dial; unpinning removes from speed dial
- **Bookmark Organization ↔ Folder Management:** Moving bookmarks between folders updates folder tree structure
- **Search ↔ All Features:** Search queries across all bookmarks and folders regardless of organization
- **Import/Export ↔ All Features:** Import creates folders and bookmarks; export includes all organizational structure

### Shared business rules

1. **Folder Tree Integrity:** All operations must maintain valid parent-child relationships in folder hierarchy
2. **Bookmark Ownership:** Every bookmark must belong to exactly one folder at all times
3. **URL Validation:** All bookmark URLs must be validated for proper format (http/https protocol)
4. **Unique Identifiers:** All folders and bookmarks must have unique IDs system-wide
5. **Atomicity:** All state changes must be atomic—either fully succeed or fully fail
6. **Non-Empty Names:** Folder and bookmark names must be non-empty and length-bounded

### Data consistency requirements

- **Strong Consistency:** Folder and bookmark CRUD operations require strong consistency
- **Eventual Consistency:** Favicon fetching can be eventually consistent (asynchronous)
- **Transactional Boundaries:** Folder aggregate is the transactional boundary for folder operations; cascade deletes
  must be atomic
- **Event Publishing:** Events must be published after successful persistence (transactional outbox pattern)
- **Real-Time Updates:** Speed dial and search results should update in real-time via event subscriptions

---

## Business constraints impact

### BC-001: Budget

Bookmarks management must operate within zero-cost infrastructure constraints:

- **Favicon Fetching:** Use free favicon services or direct domain fetching (no paid CDN required)
- **Icon Storage:** Use free-tier object storage (e.g., S3 free tier, Cloudflare R2) or local file system
- **Search:** Use database full-text search capabilities (no Elasticsearch or paid search service)
- **Import/Export:** Server-side processing only (no external conversion services)

### BC-002: Timeline

Bookmarks management is on critical path for MVP (3-6 months):

- **Must Have features** (FR-BKM-001, 002, 003, 005, 008) required for MVP
- **Should Have features** (FR-BKM-004, 006, 007) enhance UX but can be simplified or deferred
- **Could Have feature** (FR-BKM-009) explicitly post-MVP
- Prioritize core CRUD operations and speed dial for initial release
- Defer advanced features like comprehensive search and import/export

### BC-003: Resources

Single-developer constraints affect Bookmarks management:

- **Leverage UI Libraries:** Use existing drag-and-drop libraries (Angular CDK) for reordering
- **Simplify Favicon Management:** Use browser's built-in favicon fetching where possible
- **Automate Testing:** Heavy investment in unit tests for folder tree integrity
- **Incremental Development:** Build folder management first, then bookmarks, then speed dial

### BC-004: Technology stack

Bookmarks management aligns with chosen stack:

- **Frontend:** Angular components for folder tree, bookmark grid, speed dial (Angular Material UI)
- **Backend:** Spring Boot REST APIs for bookmark/folder CRUD
- **Database:** PostgreSQL with recursive CTEs for folder tree queries
- **File Storage:** Local file system or S3-compatible storage for icons
- **Search:** PostgreSQL full-text search with GIN indexes

---

## Success metrics alignment

### Technical metrics (BR-003)

| Metric                | Target        | Bookmarks contribution                                       |
|-----------------------|---------------|--------------------------------------------------------------|
| **Page Load Time**    | < 2 seconds   | Efficient folder tree loading, lazy loading icons            |
| **API Response Time** | < 200ms (p95) | Optimized bookmark/folder CRUD, indexed search queries       |
| **Test Coverage**     | > 80%         | Comprehensive unit/integration tests for all FR-BKM features |
| **Lighthouse Score**  | > 90          | Optimized speed dial rendering, responsive grid layouts      |

### Portfolio quality metrics (BR-001)

| Metric                         | Target             | Bookmarks contribution                                         |
|--------------------------------|--------------------|----------------------------------------------------------------|
| **Architecture Documentation** | All views complete | Folder aggregate design, bookmark lifecycle, event flows       |
| **Code Quality Score**         | No critical issues | DDD patterns (aggregates, entities, value objects), validation |
| **Frontend Proficiency**       | Showcase skills    | Grid layouts, drag-and-drop, animations, responsive design     |

### User experience metrics (BR-002, BR-005)

| Metric                   | Target            | Bookmarks contribution                                         |
|--------------------------|-------------------|----------------------------------------------------------------|
| **Task Completion Rate** | > 95%             | Intuitive folder/bookmark management, fast speed dial access   |
| **Mobile Usability**     | Fully Responsive  | Responsive folder tree, speed dial grid adapts to all sizes    |
| **Accessibility Score**  | WCAG 2.1 Level AA | Keyboard navigation, screen reader support for folder tree     |
| **User Satisfaction**    | > 4.0/5.0         | Fast bookmark access, visual speed dial, flexible organization |

---

## Traceability matrix

| Feature    | Business Req           | Domain Events                                               | User Stories               |
|------------|------------------------|-------------------------------------------------------------|----------------------------|
| FR-BKM-001 | BR-001, BR-002, BR-005 | FolderCreated, FolderRenamed, FolderDeleted, UserRegistered | US-BKM-001-001/002/003/004 |
| FR-BKM-002 | BR-001, BR-002, BR-005 | BookmarkCreated, BookmarkUpdated, BookmarkDeleted           | US-BKM-002-001/002/003/004 |
| FR-BKM-003 | BR-001, BR-002, BR-005 | BookmarkUpdated                                             | US-BKM-003-001/002         |
| FR-BKM-004 | BR-001, BR-002, BR-005 | BookmarkUpdated                                             | US-BKM-004-001/002         |
| FR-BKM-005 | BR-001, BR-002, BR-005 | BookmarkPinned, BookmarkUnpinned                            | US-BKM-005-001/002/003     |
| FR-BKM-006 | BR-001, BR-002, BR-005 | None (read-only)                                            | US-BKM-006-001/002/003     |
| FR-BKM-007 | BR-001, BR-002, BR-005 | BookmarkUpdated                                             | US-BKM-007-001/002/003     |
| FR-BKM-008 | BR-001, BR-002, BR-005 | None (read-only)                                            | US-BKM-008-001/002/003     |
| FR-BKM-009 | BR-001, BR-005, BR-006 | BookmarkCreated, FolderCreated (imports)                    | US-BKM-009-001/002/003     |
